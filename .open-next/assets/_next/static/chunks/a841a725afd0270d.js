(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,89271,e=>{"use strict";function r(e){if(e instanceof Error)return e.message;if("string"==typeof e)return e;if(e&&"object"==typeof e){if("message"in e)return String(e.message);if("msg"in e)return String(e.msg)}return"Тодорхойгүй алдаа гарлаа"}e.s(["getErrorMessage",()=>r])},35016,e=>{"use strict";var r=e.i(43476),a=e.i(71645),t=e.i(43066);function s({images:e,onImagesChange:s}){let[n,l]=(0,a.useState)(!1),[o,i]=(0,a.useState)(0),[c,d]=(0,a.useState)(!1),g=(0,a.useRef)(null),u=(0,t.useModal)(),b=(0,a.useCallback)(async r=>{if(r&&0!==r.length){l(!0),i(0);try{let a=new FormData;Array.from(r).forEach(e=>{a.append("files",e)});let t=await fetch("/api/images/upload",{method:"POST",body:a});if(!t.ok){let e=await t.json(),r=e.details?`${e.error}: ${Array.isArray(e.details)?e.details.join(", "):e.details}`:e.error||"Upload failed";throw Error(r)}let n=(await t.json()).images.map(e=>e.url);s([...e,...n]),i(100)}catch(e){u.showError("Upload алдаа",e instanceof Error?e.message:"Upload failed")}finally{l(!1),i(0),g.current&&(g.current.value="")}}},[e,s]),m=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?d(!0):"dragleave"===e.type&&d(!1)},[]),x=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),d(!1),e.dataTransfer.files&&e.dataTransfer.files.length>0&&b(e.dataTransfer.files)},[b]);return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Зураг *"}),(0,r.jsxs)("div",{onDragEnter:m,onDragLeave:m,onDragOver:m,onDrop:x,className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${c?"border-gray-900 bg-gray-50":"border-gray-300 bg-white hover:border-gray-400"} ${n?"opacity-50 pointer-events-none":""}`,children:[(0,r.jsx)("input",{ref:g,type:"file",multiple:!0,accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:e=>{e.target.files&&e.target.files.length>0&&b(e.target.files)},className:"hidden",disabled:n}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("svg",{className:"w-12 h-12 text-gray-400 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["Зураг чирж тавих эсвэл"," ",(0,r.jsx)("button",{type:"button",onClick:()=>g.current?.click(),className:"text-gray-900 font-medium underline hover:text-gray-700",children:"файл сонгох"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"JPG, PNG, WEBP (Хамгийн ихдээ 10MB)"})]}),n&&(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,r.jsx)("div",{className:"bg-gray-900 h-2 rounded-full transition-all",style:{width:`${o}%`}})})})]}),e.length>0&&(0,r.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:e.map((a,t)=>(0,r.jsxs)("div",{className:"relative group",children:[(0,r.jsx)("img",{src:a,alt:`Product ${t+1}`,className:"w-full aspect-square object-cover rounded-lg border border-gray-200"}),(0,r.jsx)("button",{type:"button",onClick:()=>{s(e.filter((e,r)=>r!==t))},className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"Remove image",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},t))})]})}e.s(["default",()=>s])},52767,e=>{"use strict";var r=e.i(43476),a=e.i(71645),t=e.i(11795),s=e.i(18566),n=e.i(89271),l=e.i(52292),o=e.i(35016);let i=[{value:"shoes",label:"Гутал"},{value:"clothes",label:"Хувцас"},{value:"beauty",label:"Гоо сайхан"}];function c({productType:e,setProductType:a,sizeStocks:t,setSizeStocks:s,stock:n,onStockChange:o,categoryId:c,onCategoryChange:d,subcategory:g,onSubcategoryChange:u,hasFinancing:b,onHasFinancingChange:m,categories:x}){let p=(0,l.getSizesForType)(e),h="beauty"===e;return(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 space-y-6",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-black mb-4",children:"Ангилал & Нөөц"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Ангилал"}),(0,r.jsxs)("select",{value:c,onChange:e=>d(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",children:[(0,r.jsx)("option",{value:"",children:"Сонгоно уу"}),x.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Дэд ангилал"}),(0,r.jsx)("input",{type:"text",value:g,onChange:e=>u(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",placeholder:"Жишээ: Гутал"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Бүтээгдэхүүний төрөл"}),(0,r.jsx)("select",{value:e,onChange:e=>a(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",children:i.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))})]}),h&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Нөөц *"}),(0,r.jsx)("input",{type:"number",min:0,value:n,onChange:e=>o(parseInt(e.target.value,10)||0),className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",required:!0})]}),!h&&p.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-base font-semibold text-black mb-3",children:"Размер & тоо ширхэг"}),(0,r.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:p.map(a=>(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"clothes"===e&&a in l.CLOTHES_SIZE_LABELS?l.CLOTHES_SIZE_LABELS[a]:String(a)}),(0,r.jsx)("input",{type:"number",min:0,value:t[a]??0,onChange:e=>{var r;return r=parseInt(e.target.value,10)||0,void s({...t,[a]:Math.max(0,r)})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400"})]},a))})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",checked:b,onChange:e=>m(e.target.checked),className:"w-5 h-5 text-gray-900 border-gray-300 rounded focus:ring-gray-400"}),(0,r.jsx)("label",{className:"ml-3 text-base font-medium text-black",children:"Зээлийн боломжтой"})]})]})}function d({product:e,productVariants:i}){let d=e?.product_type||"shoes",[g,u]=(0,a.useState)({name_en:e?.name_en||"",name_mn:e?.name_mn||"",brand:e?.brand||"",sku:e?.sku||"",price:e?.price||0,original_price:e?.original_price||0,discount:e?.discount||0,stock:e?.stock||0,description:e?.description||"",subcategory:e?.subcategory||"",category_id:e?.category_id?.toString()??"",brand_color:e?.brand_color||"#F5F5F5",image_color:e?.image_color||"#FAFAFA",has_financing:e?.has_financing||!1}),[b,m]=(0,a.useState)(d),[x,p]=(0,a.useState)(()=>{let e,r;return e=(0,l.getSizesForType)(d),r={},e.forEach(e=>{r[e]=0}),i?.length&&i.forEach(e=>{null!=e.size&&(r[e.size]=e.stock??0)}),r}),[h,f]=(0,a.useState)([]),[y,j]=(0,a.useState)(!1),[v,k]=(0,a.useState)(""),[N,_]=(0,a.useState)(e?.images||[]),w=(0,s.useRouter)(),S=(0,t.createClient)();async function C(){let{data:e}=await S.from("categories").select("*").order("name",{ascending:!0});e&&f(e)}function E(e){let{name:r,value:a,type:t}=e.target;"checkbox"===t?u(a=>({...a,[r]:e.target.checked})):u(e=>({...e,[r]:a}))}async function T(r){r.preventDefault(),j(!0),k("");try{let r=(0,l.getSizesForType)(b),a="beauty"===b,t=a?parseInt(g.stock.toString(),10):0,s={title:g.name_en||g.name_mn||"Untitled Product",name_en:g.name_en,name_mn:g.name_mn,brand:g.brand,sku:g.sku,price:parseInt(g.price.toString(),10),original_price:parseInt(g.original_price.toString(),10),discount:parseInt(g.discount.toString(),10),stock:t,sizes:r,product_type:b,description:g.description,subcategory:g.subcategory,category_id:g.category_id?parseInt(g.category_id.toString(),10):null,brand_color:g.brand_color,image_color:g.image_color,has_financing:g.has_financing,images:N,...a?{}:{sizeStocks:x}};if(e?.id){let r=await fetch(`/api/admin/products/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),a=await r.json().catch(()=>({}));if(!r.ok)throw Error(a.error||"Update failed");k("Бүтээгдэхүүн амжилттай шинэчлэгдлээ!")}else{let e=await fetch("/api/admin/products",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),r=await e.json().catch(()=>({}));if(!e.ok)throw Error(r.error||"Create failed");k("Бүтээгдэхүүн амжилттай нэмэгдлээ!")}setTimeout(()=>{w.push("/admin/products"),w.refresh()},1500)}catch(e){k(`Алдаа гарлаа: ${(0,n.getErrorMessage)(e)}`)}finally{j(!1)}}return(0,a.useEffect)(()=>{C()},[]),(0,a.useEffect)(()=>{let e=(0,l.getSizesForType)(b);p(r=>e.reduce((e,a)=>({...e,[a]:r[a]??0}),{}))},[b]),(0,r.jsxs)("form",{onSubmit:T,className:"max-w-4xl space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 space-y-6",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-black mb-4",children:"Зураг"}),(0,r.jsx)(o.default,{images:N,onImagesChange:_})]}),(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 space-y-6",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-black mb-4",children:"Үндсэн мэдээлэл"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Нэр (Англи) *"}),(0,r.jsx)("input",{type:"text",name:"name_en",value:g.name_en,onChange:E,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Нэр (Монгол) *"}),(0,r.jsx)("input",{type:"text",name:"name_mn",value:g.name_mn,onChange:E,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",required:!0})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Брэнд *"}),(0,r.jsx)("input",{type:"text",name:"brand",value:g.brand,onChange:E,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"SKU *"}),(0,r.jsx)("input",{type:"text",name:"sku",value:g.sku,onChange:E,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",required:!0})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Тайлбар"}),(0,r.jsx)("textarea",{name:"description",value:g.description,onChange:E,rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400"})]})]}),(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 space-y-6",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-black mb-4",children:"Үнийн мэдээлэл"}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Үнэ *"}),(0,r.jsx)("input",{type:"number",name:"price",value:g.price,onChange:E,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Анхны үнэ *"}),(0,r.jsx)("input",{type:"number",name:"original_price",value:g.original_price,onChange:E,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Хөнгөлөлт (%)"}),(0,r.jsx)("input",{type:"number",name:"discount",value:g.discount,onChange:E,min:"0",max:"100",className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400"})]})]})]}),(0,r.jsx)(c,{productType:b,setProductType:m,sizeStocks:x,setSizeStocks:p,stock:g.stock,onStockChange:e=>u(r=>({...r,stock:e})),categoryId:g.category_id,onCategoryChange:e=>u(r=>({...r,category_id:e})),subcategory:g.subcategory,onSubcategoryChange:e=>u(r=>({...r,subcategory:e})),hasFinancing:g.has_financing,onHasFinancingChange:e=>u(r=>({...r,has_financing:e})),categories:h}),v&&(0,r.jsx)("div",{className:`p-4 rounded-lg ${v.includes("амжилттай")?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"}`,children:v}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)("button",{type:"submit",disabled:y,className:`px-6 py-3 rounded-lg text-base font-medium transition-colors ${y?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-gray-900 text-white hover:bg-gray-800"}`,children:y?"Хадгалж байна...":e?.id?"Шинэчлэх":"Нэмэх"}),(0,r.jsx)("button",{type:"button",onClick:()=>w.back(),className:"px-6 py-3 border border-gray-300 rounded-lg text-base font-medium text-gray-700 hover:bg-gray-50 transition-colors",children:"Цуцлах"})]})]})}e.s(["default",()=>d],52767)}]);