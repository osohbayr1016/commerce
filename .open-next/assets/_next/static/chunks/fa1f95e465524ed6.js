(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,89271,e=>{"use strict";function r(e){if(e instanceof Error)return e.message;if("string"==typeof e)return e;if(e&&"object"==typeof e){if("message"in e)return String(e.message);if("msg"in e)return String(e.msg)}return"Тодорхойгүй алдаа гарлаа"}e.s(["getErrorMessage",()=>r])},35016,e=>{"use strict";var r=e.i(43476),a=e.i(71645),t=e.i(43066);function s({images:e,onImagesChange:s}){let[n,l]=(0,a.useState)(!1),[o,i]=(0,a.useState)(0),[c,d]=(0,a.useState)(!1),u=(0,a.useRef)(null),g=(0,t.useModal)(),b=(0,a.useCallback)(async r=>{if(r&&0!==r.length){l(!0),i(0);try{let a=new FormData;Array.from(r).forEach(e=>{a.append("files",e)});let t=await fetch("/api/images/upload",{method:"POST",body:a});if(!t.ok){let e=await t.json(),r=e.details?`${e.error}: ${Array.isArray(e.details)?e.details.join(", "):e.details}`:e.error||"Upload failed";throw Error(r)}let n=(await t.json()).images.map(e=>e.url);s([...e,...n]),i(100)}catch(e){g.showError("Upload алдаа",e instanceof Error?e.message:"Upload failed")}finally{l(!1),i(0),u.current&&(u.current.value="")}}},[e,s]),m=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?d(!0):"dragleave"===e.type&&d(!1)},[]),x=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),d(!1),e.dataTransfer.files&&e.dataTransfer.files.length>0&&b(e.dataTransfer.files)},[b]);return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Зураг *"}),(0,r.jsxs)("div",{onDragEnter:m,onDragLeave:m,onDragOver:m,onDrop:x,className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${c?"border-gray-900 bg-gray-50":"border-gray-300 bg-white hover:border-gray-400"} ${n?"opacity-50 pointer-events-none":""}`,children:[(0,r.jsx)("input",{ref:u,type:"file",multiple:!0,accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:e=>{e.target.files&&e.target.files.length>0&&b(e.target.files)},className:"hidden",disabled:n}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("svg",{className:"w-12 h-12 text-gray-400 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["Зураг чирж тавих эсвэл"," ",(0,r.jsx)("button",{type:"button",onClick:()=>u.current?.click(),className:"text-gray-900 font-medium underline hover:text-gray-700",children:"файл сонгох"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"JPG, PNG, WEBP (Хамгийн ихдээ 10MB)"})]}),n&&(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,r.jsx)("div",{className:"bg-gray-900 h-2 rounded-full transition-all",style:{width:`${o}%`}})})})]}),e.length>0&&(0,r.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:e.map((a,t)=>(0,r.jsxs)("div",{className:"relative group",children:[(0,r.jsx)("img",{src:a,alt:`Product ${t+1}`,className:"w-full aspect-square object-cover rounded-lg border border-gray-200"}),(0,r.jsx)("button",{type:"button",onClick:()=>{s(e.filter((e,r)=>r!==t))},className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"Remove image",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},t))})]})}e.s(["default",()=>s])},52767,e=>{"use strict";var r=e.i(43476),a=e.i(71645),t=e.i(11795),s=e.i(18566),n=e.i(89271),l=e.i(52292),o=e.i(35016);let i=[{value:"shoes",label:"Гутал"},{value:"clothes",label:"Хувцас"},{value:"beauty",label:"Гоо сайхан"}];function c({productType:e,setProductType:a,sizeStocks:t,setSizeStocks:s,onAddSize:n,onRemoveSize:l,stock:o,onStockChange:c,categoryId:d,onCategoryChange:u,subcategory:g,onSubcategoryChange:b,hasFinancing:m,onHasFinancingChange:x,categories:p}){let h="beauty"===e,f=Object.entries(t).map(([e,r])=>({size:Number(e),stock:r})).filter(e=>!isNaN(e.size)).sort((e,r)=>e.size-r.size);return(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 space-y-6",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-black mb-4",children:"Ангилал & Нөөц"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Ангилал"}),(0,r.jsxs)("select",{value:d,onChange:e=>u(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",children:[(0,r.jsx)("option",{value:"",children:"Сонгоно уу"}),p.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Дэд ангилал"}),(0,r.jsx)("input",{type:"text",value:g,onChange:e=>b(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",placeholder:"Жишээ: Гутал"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Бүтээгдэхүүний төрөл"}),(0,r.jsx)("select",{value:e,onChange:e=>a(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",children:i.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))})]}),h&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Нөөц *"}),(0,r.jsx)("input",{type:"number",min:0,value:o,onChange:e=>c(parseInt(e.target.value,10)||0),className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",required:!0})]}),!h&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-base font-semibold text-black mb-3",children:"Размер & тоо ширхэг"}),0===f.length?(0,r.jsxs)("div",{className:"flex flex-col items-start gap-2",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Размер нэмэх товч дарж размер болон тоо ширхэг оруулна уу."}),(0,r.jsx)("button",{type:"button",onClick:n,className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Размер нэмэх"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"space-y-3",children:f.map(({size:e,stock:a})=>(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-3 gap-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 min-w-[120px]",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700 whitespace-nowrap",children:"Размер"}),(0,r.jsx)("input",{type:"number",min:0,value:e,onChange:r=>{let a;(a=Math.max(0,Math.floor(parseInt(r.target.value,10)||0)))!==e&&s(r=>{let t={...r};return delete t[e],t[a]=r[e]??0,t})},className:"w-20 px-3 py-2 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 min-w-[120px]",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700 whitespace-nowrap",children:"Тоо ширхэг"}),(0,r.jsx)("input",{type:"number",min:0,value:a,onChange:r=>{var a;return a=parseInt(r.target.value,10)||0,void s({...t,[e]:Math.max(0,a)})},className:"w-20 px-3 py-2 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400"})]}),(0,r.jsx)("button",{type:"button",onClick:()=>l(e),className:"text-sm text-red-600 hover:text-red-800","aria-label":"Remove size",children:"Устгах"})]},e))}),(0,r.jsx)("button",{type:"button",onClick:n,className:"mt-3 px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Размер нэмэх"})]})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",checked:m,onChange:e=>x(e.target.checked),className:"w-5 h-5 text-gray-900 border-gray-300 rounded focus:ring-gray-400"}),(0,r.jsx)("label",{className:"ml-3 text-base font-medium text-black",children:"Зээлийн боломжтой"})]})]})}function d({product:e,productVariants:i}){let d=e?.product_type||"shoes",[u,g]=(0,a.useState)({name_en:e?.name_en||"",name_mn:e?.name_mn||"",brand:e?.brand||"",sku:e?.sku||"",price:e?.price||0,original_price:e?.original_price||0,discount:e?.discount||0,stock:e?.stock||0,description:e?.description||"",subcategory:e?.subcategory||"",category_id:e?.category_id?.toString()??"",brand_color:e?.brand_color||"#F5F5F5",image_color:e?.image_color||"#FAFAFA",has_financing:e?.has_financing||!1}),[b,m]=(0,a.useState)(d),[x,p]=(0,a.useState)(()=>(function(e,r){if(r?.length){let e={};return r.forEach(r=>{null!=r.size&&(e[r.size]=r.stock??0)}),e}return{}})(0,i)),[h,f]=(0,a.useState)([]),[y,j]=(0,a.useState)(!1),[v,k]=(0,a.useState)(""),[N,w]=(0,a.useState)(e?.images||[]),_=(0,s.useRouter)(),C=(0,t.createClient)(),S=(0,a.useRef)(b);async function T(){let{data:e}=await C.from("categories").select("id, name, slug").order("name",{ascending:!0});e&&f(e)}function E(e){let{name:r,value:a,type:t}=e.target;"checkbox"===t?g(a=>({...a,[r]:e.target.checked})):g(e=>({...e,[r]:a}))}async function z(r){r.preventDefault(),j(!0),k("");try{let r="beauty"===b,a=r?[]:Object.keys(x).map(Number).filter(e=>!isNaN(e)&&e>=0).sort((e,r)=>e-r),t=r?parseInt(u.stock.toString(),10):0,s={title:u.name_en||u.name_mn||"Untitled Product",name_en:u.name_en,name_mn:u.name_mn,brand:u.brand,sku:u.sku,price:parseInt(u.price.toString(),10),original_price:parseInt(u.original_price.toString(),10),discount:parseInt(u.discount.toString(),10),stock:t,sizes:a,product_type:b,description:u.description,subcategory:u.subcategory,category_id:u.category_id?parseInt(u.category_id.toString(),10):null,brand_color:u.brand_color,image_color:u.image_color,has_financing:u.has_financing,images:N,...r?{}:{sizeStocks:x}};if(e?.id){let r=await fetch(`/api/admin/products/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),a=await r.json().catch(()=>({}));if(!r.ok)throw Error(a.error||"Update failed");k("Бүтээгдэхүүн амжилттай шинэчлэгдлээ!")}else{let e=await fetch("/api/admin/products",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),r=await e.json().catch(()=>({}));if(!e.ok)throw Error(r.error||"Create failed");k("Бүтээгдэхүүн амжилттай нэмэгдлээ!")}setTimeout(()=>{_.push("/admin/products"),_.refresh()},1500)}catch(e){k(`Алдаа гарлаа: ${(0,n.getErrorMessage)(e)}`)}finally{j(!1)}}return(0,a.useEffect)(()=>{T()},[]),(0,a.useEffect)(()=>{S.current!==b&&(S.current=b,p({}))},[b]),(0,r.jsxs)("form",{onSubmit:z,className:"max-w-4xl space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 space-y-6",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-black mb-4",children:"Зураг"}),(0,r.jsx)(o.default,{images:N,onImagesChange:w})]}),(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 space-y-6",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-black mb-4",children:"Үндсэн мэдээлэл"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Нэр (Англи) *"}),(0,r.jsx)("input",{type:"text",name:"name_en",value:u.name_en,onChange:E,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Нэр (Монгол) *"}),(0,r.jsx)("input",{type:"text",name:"name_mn",value:u.name_mn,onChange:E,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",required:!0})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Брэнд *"}),(0,r.jsx)("input",{type:"text",name:"brand",value:u.brand,onChange:E,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"SKU *"}),(0,r.jsx)("input",{type:"text",name:"sku",value:u.sku,onChange:E,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",required:!0})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Тайлбар"}),(0,r.jsx)("textarea",{name:"description",value:u.description,onChange:E,rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400"})]})]}),(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 space-y-6",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-black mb-4",children:"Үнийн мэдээлэл"}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Үнэ *"}),(0,r.jsx)("input",{type:"number",name:"price",value:u.price,onChange:E,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Анхны үнэ *"}),(0,r.jsx)("input",{type:"number",name:"original_price",value:u.original_price,onChange:E,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Хөнгөлөлт (%)"}),(0,r.jsx)("input",{type:"number",name:"discount",value:u.discount,onChange:E,min:"0",max:"100",className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400"})]})]})]}),(0,r.jsx)(c,{productType:b,setProductType:m,sizeStocks:x,setSizeStocks:p,onAddSize:function(){let e=0===Object.keys(x).length?(0,l.getDefaultSizeForType)(b):Math.max(0,...Object.keys(x).map(Number),0)+1;p(r=>({...r,[e]:0}))},onRemoveSize:function(e){p(r=>{let a={...r};return delete a[e],a})},stock:u.stock,onStockChange:e=>g(r=>({...r,stock:e})),categoryId:u.category_id,onCategoryChange:e=>g(r=>({...r,category_id:e})),subcategory:u.subcategory,onSubcategoryChange:e=>g(r=>({...r,subcategory:e})),hasFinancing:u.has_financing,onHasFinancingChange:e=>g(r=>({...r,has_financing:e})),categories:h}),v&&(0,r.jsx)("div",{className:`p-4 rounded-lg ${v.includes("амжилттай")?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"}`,children:v}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)("button",{type:"submit",disabled:y,className:`px-6 py-3 rounded-lg text-base font-medium transition-colors ${y?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-gray-900 text-white hover:bg-gray-800"}`,children:y?"Хадгалж байна...":e?.id?"Шинэчлэх":"Нэмэх"}),(0,r.jsx)("button",{type:"button",onClick:()=>_.back(),className:"px-6 py-3 border border-gray-300 rounded-lg text-base font-medium text-gray-700 hover:bg-gray-50 transition-colors",children:"Цуцлах"})]})]})}e.s(["default",()=>d],52767)}]);