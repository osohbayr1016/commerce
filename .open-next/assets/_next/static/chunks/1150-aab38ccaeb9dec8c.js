"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1150],{12398:(e,t,r)=>{r.d(t,{default:()=>l});var a=r(95155),i=r(65380),n=r(52619),o=r.n(n);function l(){var e;let{user:t,profile:r}=(0,i.A)();return t&&r?(0,a.jsxs)(o(),{href:"/profile?tab=coins",className:"flex items-center gap-2 px-3 py-1.5 rounded-full bg-yellow-50 border border-yellow-200 hover:bg-yellow-100 transition-colors",title:"Миний монет",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-yellow-600",fill:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.31-8.86c-1.77-.45-2.34-.94-2.34-1.67 0-.84.79-1.43 2.1-1.43 1.38 0 1.9.66 1.94 1.64h1.71c-.05-1.34-.87-2.57-2.49-2.97V5H10.9v1.69c-1.51.32-2.72 1.3-2.72 2.81 0 1.79 1.49 2.69 3.66 3.21 1.95.46 2.34 1.15 2.34 1.87 0 .53-.39 1.39-2.1 1.39-1.6 0-2.23-.72-2.32-1.64H8.04c.1 1.7 1.36 2.66 2.86 2.97V19h2.34v-1.67c1.52-.29 2.72-1.16 2.73-2.77-.01-2.2-1.9-2.96-3.66-3.42z"})}),(0,a.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:(null==(e=r.coin_balance)?void 0:e.toLocaleString())||"0"})]}):null}},44001:(e,t,r)=>{r.d(t,{default:()=>c});var a=r(95155),i=r(12115),n=r(52619),o=r.n(n),l=r(20063),s=r(65380);function c(){var e,t,r,n;let[c,u]=(0,i.useState)(!1),d=(0,i.useRef)(null),{user:h,profile:f,signOut:m,isAdmin:y}=(0,s.A)(),p=(0,l.useRouter)();(0,i.useEffect)(()=>{function e(e){d.current&&!d.current.contains(e.target)&&u(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let x=async()=>{try{await m(),u(!1),p.push("/")}catch(e){}};return h?(0,a.jsxs)("div",{className:"relative",ref:d,children:[(0,a.jsxs)("button",{onClick:()=>u(!c),className:"flex items-center space-x-2 text-gray-700 hover:text-gray-900",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-900 flex items-center justify-center text-white font-medium text-sm",children:(null==f||null==(t=f.full_name)||null==(e=t[0])?void 0:e.toUpperCase())||"U"}),(0,a.jsx)("svg",{className:"w-4 h-4 transition-transform ".concat(c?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),c&&(0,a.jsxs)("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b border-gray-200",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:(null==f?void 0:f.full_name)||"Хэрэглэгч"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:(null==(r=h.user_metadata)?void 0:r.phone_number)||h.phone||(null==(n=h.email)?void 0:n.replace("@phone.app",""))}),y&&(0,a.jsx)("span",{className:"inline-block mt-2 px-2 py-1 text-xs font-medium bg-gray-900 text-white rounded",children:"Админ"})]}),(0,a.jsxs)("div",{className:"py-2",children:[(0,a.jsx)(o(),{href:"/profile",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>u(!1),children:"\uD83D\uDC64 Миний профайл"}),(0,a.jsx)(o(),{href:"/profile?tab=orders",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>u(!1),children:"\uD83D\uDCE6 Миний захиалга"}),(0,a.jsx)(o(),{href:"/profile?tab=wishlist",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>u(!1),children:"❤️ Хадгалсан"}),y&&(0,a.jsx)(o(),{href:"/admin",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>u(!1),children:"Админ самбар"})]}),(0,a.jsx)("div",{className:"border-t border-gray-200 pt-2",children:(0,a.jsx)("button",{onClick:x,className:"block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50",children:"Гарах"})})]})]}):(0,a.jsx)(o(),{href:"/auth/login",className:"text-gray-700 hover:text-gray-900 text-sm md:text-base whitespace-nowrap font-medium",children:"нэвтрэх/бүртгүүлэх"})}},52503:(e,t,r)=>{r.d(t,{CartProvider:()=>h,_:()=>f});var a=r(95155),i=r(12115),n=r(65380);async function o(e){try{for(let t of e)await s(t.id,t.quantity,t.size)}catch(e){}}async function l(){try{let e=await fetch("/api/cart");if(!e.ok)return[];return(await e.json()).items||[]}catch(e){return[]}}async function s(e,t,r){try{return(await fetch("/api/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:e,quantity:t,size:r||null})})).ok}catch(e){return!1}}async function c(e,t,r){try{return(await fetch("/api/cart",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:e,quantity:t,size:r||null})})).ok}catch(e){return!1}}async function u(e,t){try{let r=new URL("/api/cart",window.location.origin);return r.searchParams.set("product_id",e),t&&r.searchParams.set("size",t.toString()),(await fetch(r.toString(),{method:"DELETE"})).ok}catch(e){return!1}}let d=(0,i.createContext)(void 0);function h(e){let{children:t}=e,{user:r}=(0,n.A)(),[h,f]=(0,i.useState)([]),[m,y]=(0,i.useState)(!1),p=(0,i.useRef)(null),x=(0,i.useRef)(!0),g=r?"cart:".concat(r.id):null;(0,i.useEffect)(()=>{if(!r||!g)return void f([]);(async()=>{y(!0);try{let e=await l(),t=localStorage.getItem(g),r=t?JSON.parse(t):[],a=[...e];r.forEach(e=>{a.find(t=>t.id===e.id&&t.size===e.size)||a.push(e)}),f(a),localStorage.setItem(g,JSON.stringify(a)),r.length>0&&e.length!==a.length&&await o(a)}catch(t){let e=localStorage.getItem(g);f(e?JSON.parse(e):[])}finally{y(!1),x.current=!1}})()},[r,g]),(0,i.useEffect)(()=>{g&&!x.current&&localStorage.setItem(g,JSON.stringify(h))},[h,g]),(0,i.useEffect)(()=>{if(r&&g&&!x.current)return p.current&&clearTimeout(p.current),p.current=setTimeout(async()=>{y(!0);try{for(let e of h)await s(e.id,e.quantity,e.size)}catch(e){}finally{y(!1)}},1e3),()=>{p.current&&clearTimeout(p.current)}},[h,r,g]);let w=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!r)return{ok:!1};try{let r=await fetch("/api/products/".concat(e.id,"/stock"));if(r.ok){var a;let i=await r.json(),n=((null==(a=h.find(t=>t.id===e.id&&t.size===e.size))?void 0:a.quantity)||0)+t;if(i.stock<n)return{ok:!1,error:0===i.stock?"Бэлэн бараа байхгүй":"Зөвхөн ".concat(i.stock," ширхэг үлдсэн")}}}catch(e){}f(r=>r.find(t=>t.id===e.id&&t.size===e.size)?r.map(r=>r.id===e.id&&r.size===e.size?{...r,quantity:r.quantity+t}:r):[...r,{...e,quantity:t}]);try{await s(e.id,t,e.size)}catch(e){}return{ok:!0}},v=async(e,t)=>{let r=Math.max(1,t),a=h.find(t=>t.id===e);try{let t=await fetch("/api/products/".concat(e,"/stock"));if(t.ok){let i=await t.json();if(i.stock<r){let t=Math.min(i.stock,r);f(r=>r.map(r=>r.id===e?{...r,quantity:t}:r)),a&&await c(e,t,a.size);return}}}catch(e){}if(f(t=>t.map(t=>t.id===e?{...t,quantity:r}:t)),a)try{await c(e,r,a.size)}catch(e){}},b=async e=>{let t=h.find(t=>t.id===e);if(f(t=>t.filter(t=>t.id!==e)),t)try{await u(e,t.size)}catch(e){}},k=async()=>{if(r)try{for(let e of h)await u(e.id,e.size)}catch(e){}f([])},j=(0,i.useMemo)(()=>h.reduce((e,t)=>e+t.price*t.quantity,0),[h]),N=(0,i.useMemo)(()=>h.reduce((e,t)=>e+t.quantity,0),[h]);return(0,a.jsx)(d.Provider,{value:{items:h,subtotal:j,totalItems:N,addItem:w,updateQuantity:v,removeItem:b,clearCart:k,syncing:m},children:t})}function f(){let e=(0,i.useContext)(d);if(!e)throw Error("useCart must be used within a CartProvider");return e}},54133:(e,t,r)=>{r.d(t,{default:()=>l});var a=r(95155),i=r(52619),n=r.n(i),o=r(52503);function l(){let{totalItems:e}=(0,o._)();return(0,a.jsxs)(n(),{href:"/cart",className:"relative inline-flex items-center justify-center w-9 h-9 rounded-full border border-gray-200 text-gray-600 hover:text-gray-900 hover:border-gray-300","aria-label":"cart",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H6.4M7 13l-1.6 8H19M7 13l.4-2M9 21a1 1 0 100-2 1 1 0 000 2zm8 0a1 1 0 100-2 1 1 0 000 2z"})}),e>0&&(0,a.jsx)("span",{className:"absolute -top-1 -right-1 flex h-5 min-w-[20px] items-center justify-center rounded-full bg-gray-900 px-1.5 text-[10px] font-semibold text-white",children:e>99?"99+":e})]})}},65380:(e,t,r)=>{r.d(t,{A:()=>s,AuthProvider:()=>l});var a=r(95155),i=r(12115),n=r(96648);let o=(0,i.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,i.useState)(null),[s,c]=(0,i.useState)(null),[u,d]=(0,i.useState)(!0),h=(0,n.U)();(0,i.useEffect)(()=>{h.auth.getSession().then(e=>{var t;let{data:{session:r}}=e;l(null!=(t=null==r?void 0:r.user)?t:null),(null==r?void 0:r.user)?f(r.user.id):d(!1)});let{data:{subscription:e}}=h.auth.onAuthStateChange((e,t)=>{var r;l(null!=(r=null==t?void 0:t.user)?r:null),(null==t?void 0:t.user)?f(t.user.id):(c(null),d(!1))});return()=>e.unsubscribe()},[]);let f=async e=>{try{let{data:t,error:r}=await h.from("profiles").select("*").eq("id",e).single();if(r)throw r;c(t)}catch(e){}finally{d(!1)}},m=async(e,t,r,a)=>{let i=t.replace(/[^0-9]/g,""),{data:n,error:o}=await h.auth.signUp({email:e,password:r,options:{data:{full_name:a||"",phone_number:i},emailRedirectTo:void 0}});if(o){if(o.message.includes("Signups not allowed"))throw Error('Бүртгэл идэвхгүй байна. Суpabase dashboard-аас "Enable email signups" асаах шаардлагатай. Authentication → Providers → Email → Enable email signups');throw o}n.user&&(l(n.user),await f(n.user.id))},y=async(e,t)=>{let r;if(e.includes("@"))r=e.trim();else{let t=e.replace(/[^0-9]/g,"");if(!t||t.length<8)throw Error("Утасны дугаар буруу байна");let{data:a,error:i}=await h.from("profiles").select("email").eq("phone_number",t).single();if(i)throw Error("Утасны дугаараар бүртгэл олдсонгүй. И-мэйл ашиглана уу.");if(!(null==a?void 0:a.email))throw Error("Бүртгэлийн мэдээлэл дутуу байна. Та дахин бүртгүүлнэ үү.");r=a.email}let{data:a,error:i}=await h.auth.signInWithPassword({email:r,password:t});if(i)throw i},p=async()=>{let{data:e,error:t}=await h.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});if(t)throw t},x=async()=>{let{error:e}=await h.auth.signOut();if(e)throw e},g=async()=>{r&&await f(r.id)},w=(null==s?void 0:s.role)==="admin";return(0,a.jsx)(o.Provider,{value:{user:r,profile:s,loading:u,signUp:m,signIn:y,signInWithGoogle:p,signOut:x,refreshProfile:g,isAdmin:w},children:t})}function s(){let e=(0,i.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}}]);