(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1547],{63:(e,a,r)=>{"use strict";var s=r(7260);r.o(s,"usePathname")&&r.d(a,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(a,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(a,{useSearchParams:function(){return s.useSearchParams}})},953:(e,a,r)=>{"use strict";r.d(a,{default:()=>c});var s=r(5155),n=r(2115),t=r(6648),l=r(63),o=r(8566);function i(e){let{images:a,onImagesChange:r}=e,[t,l]=(0,n.useState)(!1),[o,i]=(0,n.useState)(0),[c,d]=(0,n.useState)(!1),u=(0,n.useRef)(null),g=(0,n.useCallback)(async e=>{if(e&&0!==e.length){l(!0),i(0);try{let s=new FormData;Array.from(e).forEach(e=>{s.append("files",e)});let n=await fetch("/api/images/upload",{method:"POST",body:s});if(!n.ok){let e=await n.json(),a=e.details?"".concat(e.error,": ").concat(Array.isArray(e.details)?e.details.join(", "):e.details):e.error||"Upload failed";throw Error(a)}let t=(await n.json()).images.map(e=>e.url);r([...a,...t]),i(100)}catch(e){alert(e instanceof Error?e.message:"Upload failed")}finally{l(!1),i(0),u.current&&(u.current.value="")}}},[a,r]),b=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?d(!0):"dragleave"===e.type&&d(!1)},[]),m=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),d(!1),e.dataTransfer.files&&e.dataTransfer.files.length>0&&g(e.dataTransfer.files)},[g]);return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Зураг *"}),(0,s.jsxs)("div",{onDragEnter:b,onDragLeave:b,onDragOver:b,onDrop:m,className:"border-2 border-dashed rounded-lg p-8 text-center transition-colors ".concat(c?"border-gray-900 bg-gray-50":"border-gray-300 bg-white hover:border-gray-400"," ").concat(t?"opacity-50 pointer-events-none":""),children:[(0,s.jsx)("input",{ref:u,type:"file",multiple:!0,accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:e=>{e.target.files&&e.target.files.length>0&&g(e.target.files)},className:"hidden",disabled:t}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("svg",{className:"w-12 h-12 text-gray-400 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["Зураг чирж тавих эсвэл"," ",(0,s.jsx)("button",{type:"button",onClick:()=>{var e;return null==(e=u.current)?void 0:e.click()},className:"text-gray-900 font-medium underline hover:text-gray-700",children:"файл сонгох"})]}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"JPG, PNG, WEBP (Хамгийн ихдээ 10MB)"})]}),t&&(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-gray-900 h-2 rounded-full transition-all",style:{width:"".concat(o,"%")}})})})]}),a.length>0&&(0,s.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:a.map((e,n)=>(0,s.jsxs)("div",{className:"relative group",children:[(0,s.jsx)("img",{src:e,alt:"Product ".concat(n+1),className:"w-full aspect-square object-cover rounded-lg border border-gray-200"}),(0,s.jsx)("button",{type:"button",onClick:()=>{r(a.filter((e,a)=>a!==n))},className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"Remove image",children:(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},n))})]})}function c(e){var a;let{product:r}=e,[c,d]=(0,n.useState)({name_en:(null==r?void 0:r.name_en)||"",name_mn:(null==r?void 0:r.name_mn)||"",brand:(null==r?void 0:r.brand)||"",sku:(null==r?void 0:r.sku)||"",price:(null==r?void 0:r.price)||0,original_price:(null==r?void 0:r.original_price)||0,discount:(null==r?void 0:r.discount)||0,stock:(null==r?void 0:r.stock)||0,sizes:(null==r||null==(a=r.sizes)?void 0:a.join(","))||"",description:(null==r?void 0:r.description)||"",subcategory:(null==r?void 0:r.subcategory)||"",category_id:(null==r?void 0:r.category_id)||"",brand_color:(null==r?void 0:r.brand_color)||"#F5F5F5",image_color:(null==r?void 0:r.image_color)||"#FAFAFA",has_financing:(null==r?void 0:r.has_financing)||!1}),[u,g]=(0,n.useState)([]),[b,m]=(0,n.useState)(!1),[x,p]=(0,n.useState)(""),[h,f]=(0,n.useState)((null==r?void 0:r.images)||[]),y=(0,l.useRouter)(),j=(0,t.U)();async function v(){let{data:e}=await j.from("categories").select("*").order("name",{ascending:!0});e&&g(e)}function k(e){let{name:a,value:r,type:s}=e.target;"checkbox"===s?d(r=>({...r,[a]:e.target.checked})):d(e=>({...e,[a]:r}))}async function N(e){e.preventDefault(),m(!0),p("");try{let e=c.sizes?c.sizes.split(",").map(e=>parseInt(e.trim())).filter(e=>!isNaN(e)):[],a={title:c.name_en||c.name_mn||"Untitled Product",name_en:c.name_en,name_mn:c.name_mn,brand:c.brand,sku:c.sku,price:parseInt(c.price.toString()),original_price:parseInt(c.original_price.toString()),discount:parseInt(c.discount.toString()),stock:parseInt(c.stock.toString()),sizes:e,description:c.description,subcategory:c.subcategory,category_id:c.category_id?parseInt(c.category_id.toString()):null,brand_color:c.brand_color,image_color:c.image_color,has_financing:c.has_financing,images:h};if(null==r?void 0:r.id){let{error:e}=await j.from("products").update(a).eq("id",r.id);if(e)throw e;p("Бүтээгдэхүүн амжилттай шинэчлэгдлээ!")}else{let{error:e}=await j.from("products").insert([a]);if(e)throw e;p("Бүтээгдэхүүн амжилттай нэмэгдлээ!")}setTimeout(()=>{y.push("/admin/products"),y.refresh()},1500)}catch(e){p("Алдаа гарлаа: ".concat((0,o.u)(e)))}finally{m(!1)}}return(0,n.useEffect)(()=>{v()},[]),(0,s.jsxs)("form",{onSubmit:N,className:"max-w-4xl space-y-6",children:[(0,s.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 space-y-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-black mb-4",children:"Зураг"}),(0,s.jsx)(i,{images:h,onImagesChange:f})]}),(0,s.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 space-y-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-black mb-4",children:"Үндсэн мэдээлэл"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Нэр (Англи) *"}),(0,s.jsx)("input",{type:"text",name:"name_en",value:c.name_en,onChange:k,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Нэр (Монгол) *"}),(0,s.jsx)("input",{type:"text",name:"name_mn",value:c.name_mn,onChange:k,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",required:!0})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Брэнд *"}),(0,s.jsx)("input",{type:"text",name:"brand",value:c.brand,onChange:k,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"SKU *"}),(0,s.jsx)("input",{type:"text",name:"sku",value:c.sku,onChange:k,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",required:!0})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Тайлбар"}),(0,s.jsx)("textarea",{name:"description",value:c.description,onChange:k,rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400"})]})]}),(0,s.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 space-y-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-black mb-4",children:"Үнийн мэдээлэл"}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Үнэ *"}),(0,s.jsx)("input",{type:"number",name:"price",value:c.price,onChange:k,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Анхны үнэ *"}),(0,s.jsx)("input",{type:"number",name:"original_price",value:c.original_price,onChange:k,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Хөнгөлөлт (%)"}),(0,s.jsx)("input",{type:"number",name:"discount",value:c.discount,onChange:k,min:"0",max:"100",className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400"})]})]})]}),(0,s.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 space-y-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-black mb-4",children:"Ангилал & Нөөц"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Ангилал"}),(0,s.jsxs)("select",{name:"category_id",value:c.category_id,onChange:k,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",children:[(0,s.jsx)("option",{value:"",children:"Сонгоно уу"}),u.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Дэд ангилал"}),(0,s.jsx)("input",{type:"text",name:"subcategory",value:c.subcategory,onChange:k,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",placeholder:"Жишээ: Гутал"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Нөөц *"}),(0,s.jsx)("input",{type:"number",name:"stock",value:c.stock,onChange:k,min:"0",className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-base font-semibold text-black mb-2",children:"Размерууд (таслалаар тусгаарлах)"}),(0,s.jsx)("input",{type:"text",name:"sizes",value:c.sizes,onChange:k,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-gray-400",placeholder:"35, 36, 37, 38, 39, 40"})]})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",name:"has_financing",checked:c.has_financing,onChange:k,className:"w-5 h-5 text-gray-900 border-gray-300 rounded focus:ring-gray-400"}),(0,s.jsx)("label",{className:"ml-3 text-base font-medium text-black",children:"Зээлийн боломжтой"})]})]}),x&&(0,s.jsx)("div",{className:"p-4 rounded-lg ".concat(x.includes("амжилттай")?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"),children:x}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)("button",{type:"submit",disabled:b,className:"px-6 py-3 rounded-lg text-base font-medium transition-colors ".concat(b?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-gray-900 text-white hover:bg-gray-800"),children:b?"Хадгалж байна...":(null==r?void 0:r.id)?"Шинэчлэх":"Нэмэх"}),(0,s.jsx)("button",{type:"button",onClick:()=>y.back(),className:"px-6 py-3 border border-gray-300 rounded-lg text-base font-medium text-gray-700 hover:bg-gray-50 transition-colors",children:"Цуцлах"})]})]})}},1547:(e,a,r)=>{Promise.resolve().then(r.bind(r,953))},6648:(e,a,r)=>{"use strict";r.d(a,{U:()=>n});var s=r(5417);function n(){return(0,s.createBrowserClient)("https://ejdwrepyuznanwujidai.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVqZHdyZXB5dXpuYW53dWppZGFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzNjk3NTYsImV4cCI6MjA4Mzk0NTc1Nn0.MRJe6csColzMRDpAWa-Ma99noAk6n8SbnXXHP2rNAJ4")}},8566:(e,a,r)=>{"use strict";function s(e){return e instanceof Error?e.message:"string"==typeof e?e:e&&"object"==typeof e&&"message"in e?String(e.message):"Тодорхойгүй алдаа гарлаа"}r.d(a,{u:()=>s})}}]);