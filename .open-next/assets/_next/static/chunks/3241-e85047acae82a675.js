"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3241],{7604:(e,t,r)=>{r.d(t,{default:()=>i});var n=r(95155),a=r(12115),l=r(15239),s=r(20063),o=r(64269);function i(e){let{onClose:t,initialQuery:r=""}=e,[i,c]=(0,a.useState)(r),[u,d]=(0,a.useState)([]),[h,m]=(0,a.useState)(!1),[x,f]=(0,a.useState)(-1),[g,p]=(0,a.useState)(!1),y=(0,s.useRouter)(),b=(0,a.useRef)(null),v=(0,a.useRef)(null),w=(0,a.useRef)(null);(0,a.useEffect)(()=>{b.current&&b.current.focus()},[]),(0,a.useEffect)(()=>{r&&r!==i&&c(r)},[r]),(0,a.useEffect)(()=>{if(i.length<2){d([]),p(!1);return}return w.current&&clearTimeout(w.current),m(!0),p(!0),w.current=setTimeout(async()=>{try{let e=await fetch("/api/search/autocomplete?q=".concat(encodeURIComponent(i)));if(e.ok){let t=await e.json();d(t.results||[])}else d([])}catch(e){d([])}finally{m(!1)}},300),()=>{w.current&&clearTimeout(w.current)}},[i]);let j=e=>{let r=(0,o.z)("".concat(e.brand," ").concat(e.name),e.id);y.push("/products/".concat(r)),c(""),d([]),p(!1),null==t||t()},k=e=>{e.preventDefault(),i.trim().length>=2&&(y.push("/search?q=".concat(encodeURIComponent(i.trim()))),c(""),d([]),p(!1),null==t||t())};return(0,a.useEffect)(()=>{if(x>=0&&v.current){let e=v.current.children[x];e&&e.scrollIntoView({block:"nearest",behavior:"smooth"})}},[x]),(0,n.jsxs)("div",{className:"relative w-full",children:[(0,n.jsxs)("form",{onSubmit:k,className:"relative",children:[(0,n.jsx)("input",{ref:b,type:"text",value:i,onChange:e=>{c(e.target.value),f(-1)},onKeyDown:e=>{if(!g||0===u.length){"Enter"===e.key&&i.trim().length>=2&&k(e);return}switch(e.key){case"ArrowDown":e.preventDefault(),f(e=>e<u.length-1?e+1:e);break;case"ArrowUp":e.preventDefault(),f(e=>e>0?e-1:-1);break;case"Enter":e.preventDefault(),x>=0&&x<u.length?j(u[x]):i.trim().length>=2&&k(e);break;case"Escape":p(!1),d([]),null==t||t()}},onFocus:()=>{(u.length>0||i.length>=2)&&p(!0)},placeholder:"Бүтээгдэхүүн хайх...",className:"w-full rounded-full border border-gray-300 px-4 py-2 pl-10 pr-10 text-sm text-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-gray-900"}),(0,n.jsx)("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),i.length>0&&(0,n.jsx)("button",{type:"button",onClick:()=>{c(""),d([]),p(!1),b.current&&b.current.focus()},className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 hover:text-gray-600","aria-label":"Clear search",children:(0,n.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),g&&(i.length>=2||u.length>0)&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>{p(!1)}}),(0,n.jsx)("div",{ref:v,className:"absolute top-full left-0 right-0 mt-2 bg-white border border-gray-200 rounded-lg shadow-xl z-20 max-h-96 overflow-y-auto",children:h?(0,n.jsx)("div",{className:"px-4 py-6 text-sm text-gray-500 text-center",children:(0,n.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,n.jsxs)("svg",{className:"animate-spin h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Хайж байна..."]})}):u.length>0?(0,n.jsx)(n.Fragment,{children:u.map((e,t)=>(0,n.jsxs)("button",{onClick:()=>j(e),className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-gray-50 transition-colors text-left border-b border-gray-100 last:border-b-0 ".concat(t===x?"bg-gray-50":""," ").concat(0===t?"rounded-t-lg":""," ").concat(t===u.length-1?"rounded-b-lg":""),children:[e.image?(0,n.jsx)("div",{className:"w-12 h-12 rounded border border-gray-200 flex-shrink-0 overflow-hidden relative",children:(0,n.jsx)(l.default,{src:e.image,alt:e.name,fill:!0,sizes:"48px",className:"object-cover",loading:"lazy"})}):(0,n.jsx)("div",{className:"w-12 h-12 bg-gray-100 rounded border border-gray-200 flex-shrink-0"}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.name}),e.nameMn&&(0,n.jsx)("p",{className:"text-xs text-gray-500 truncate",children:e.nameMn}),(0,n.jsxs)("p",{className:"text-xs text-gray-600 mt-0.5",children:[e.brand&&"".concat(e.brand," • "),new Intl.NumberFormat("mn-MN").format(e.price)," ₮"]})]})]},e.id))}):i.length>=2?(0,n.jsxs)("div",{className:"px-4 py-6 text-sm text-gray-500 text-center",children:[(0,n.jsx)("p",{children:"Илэрц олдсонгүй"}),(0,n.jsxs)("p",{className:"text-xs mt-1 text-gray-400",children:['"',i,'" гэсэн хайлтаар бүтээгдэхүүн олдсонгүй']})]}):null})]})]})}},32025:(e,t,r)=>{r.d(t,{default:()=>s});var n=r(95155),a=r(12115),l=r(7604);function s(){let[e,t]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{let r=r=>{"Escape"===r.key&&e&&t(!1)};return e?(document.addEventListener("keydown",r),document.body.style.overflow="hidden"):document.body.style.overflow="",()=>{document.removeEventListener("keydown",r),document.body.style.overflow=""}},[e]),e)?(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-start justify-center pt-20 px-4",onClick:()=>t(!1),children:(0,n.jsxs)("div",{className:"w-full max-w-2xl bg-white rounded-lg shadow-xl p-4",onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Хайлт"}),(0,n.jsx)("button",{onClick:()=>t(!1),className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close search",children:(0,n.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,n.jsx)(l.default,{onClose:()=>t(!1)})]})})}):(0,n.jsx)("button",{onClick:()=>t(!0),className:"inline-flex items-center justify-center w-9 h-9 rounded-full border border-gray-200 text-gray-600 hover:text-gray-900 hover:border-gray-300 transition-colors","aria-label":"Хайлт нээх",children:(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})}},44001:(e,t,r)=>{r.d(t,{default:()=>c});var n=r(95155),a=r(12115),l=r(52619),s=r.n(l),o=r(20063),i=r(65380);function c(){var e,t,r,l;let[c,u]=(0,a.useState)(!1),d=(0,a.useRef)(null),{user:h,profile:m,signOut:x,isAdmin:f}=(0,i.A)(),g=(0,o.useRouter)();(0,a.useEffect)(()=>{function e(e){d.current&&!d.current.contains(e.target)&&u(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let p=async()=>{try{await x(),u(!1),g.push("/")}catch(e){}};return h?(0,n.jsxs)("div",{className:"relative",ref:d,children:[(0,n.jsxs)("button",{onClick:()=>u(!c),className:"flex items-center space-x-2 text-gray-700 hover:text-gray-900",children:[(0,n.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-900 flex items-center justify-center text-white font-medium text-sm",children:(null==m||null==(t=m.full_name)||null==(e=t[0])?void 0:e.toUpperCase())||"U"}),(0,n.jsx)("svg",{className:"w-4 h-4 transition-transform ".concat(c?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),c&&(0,n.jsxs)("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50",children:[(0,n.jsxs)("div",{className:"px-4 py-3 border-b border-gray-200",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-900",children:(null==m?void 0:m.full_name)||"Хэрэглэгч"}),(0,n.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:(null==(r=h.user_metadata)?void 0:r.phone_number)||h.phone||(null==(l=h.email)?void 0:l.replace("@phone.app",""))}),f&&(0,n.jsx)("span",{className:"inline-block mt-2 px-2 py-1 text-xs font-medium bg-gray-900 text-white rounded",children:"Админ"})]}),(0,n.jsxs)("div",{className:"py-2",children:[(0,n.jsx)(s(),{href:"/profile",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>u(!1),children:"\uD83D\uDC64 Миний профайл"}),(0,n.jsx)(s(),{href:"/profile?tab=orders",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>u(!1),children:"\uD83D\uDCE6 Миний захиалга"}),(0,n.jsx)(s(),{href:"/profile?tab=wishlist",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>u(!1),children:"❤️ Хадгалсан"}),f&&(0,n.jsx)(s(),{href:"/admin",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>u(!1),children:"Админ самбар"})]}),(0,n.jsx)("div",{className:"border-t border-gray-200 pt-2",children:(0,n.jsx)("button",{onClick:p,className:"block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50",children:"Гарах"})})]})]}):(0,n.jsx)(s(),{href:"/auth/login",className:"text-gray-700 hover:text-gray-900 text-sm md:text-base whitespace-nowrap font-medium",children:"нэвтрэх/бүртгүүлэх"})}},64269:(e,t,r)=>{function n(e,t){let r=e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");if(t){let e=t.replace(/[^a-z0-9]+/gi,"-").toLowerCase();return"".concat(r,"-").concat(e)}return r}function a(e){return new Intl.NumberFormat("mn-MN").format(e)}r.d(t,{$:()=>a,z:()=>n})},65380:(e,t,r)=>{r.d(t,{A:()=>i,AuthProvider:()=>o});var n=r(95155),a=r(12115),l=r(96648);let s=(0,a.createContext)(void 0);function o(e){let{children:t}=e,[r,o]=(0,a.useState)(null),[i,c]=(0,a.useState)(null),[u,d]=(0,a.useState)(!0),h=(0,l.U)();(0,a.useEffect)(()=>{h.auth.getSession().then(e=>{var t;let{data:{session:r}}=e;o(null!=(t=null==r?void 0:r.user)?t:null),(null==r?void 0:r.user)?m(r.user.id):d(!1)});let{data:{subscription:e}}=h.auth.onAuthStateChange((e,t)=>{var r;o(null!=(r=null==t?void 0:t.user)?r:null),(null==t?void 0:t.user)?m(t.user.id):(c(null),d(!1))});return()=>e.unsubscribe()},[]);let m=async e=>{try{let{data:t,error:r}=await h.from("profiles").select("*").eq("id",e).single();if(r)throw r;c(t)}catch(e){}finally{d(!1)}},x=async(e,t,r,n)=>{let a=t.replace(/[^0-9]/g,""),{data:l,error:s}=await h.auth.signUp({email:e,password:r,options:{data:{full_name:n||"",phone_number:a},emailRedirectTo:void 0}});if(s){if(s.message.includes("Signups not allowed"))throw Error('Бүртгэл идэвхгүй байна. Суpabase dashboard-аас "Enable email signups" асаах шаардлагатай. Authentication → Providers → Email → Enable email signups');throw s}l.user&&(o(l.user),await m(l.user.id))},f=async(e,t)=>{let r;if(e.includes("@"))r=e.trim();else{let t=e.replace(/[^0-9]/g,"");if(!t||t.length<8)throw Error("Утасны дугаар буруу байна");let{data:n,error:a}=await h.from("profiles").select("email").eq("phone_number",t).single();if(a)throw Error("Утасны дугаараар бүртгэл олдсонгүй. И-мэйл ашиглана уу.");if(!(null==n?void 0:n.email))throw Error("Бүртгэлийн мэдээлэл дутуу байна. Та дахин бүртгүүлнэ үү.");r=n.email}let{data:n,error:a}=await h.auth.signInWithPassword({email:r,password:t});if(a)throw a},g=async()=>{let{data:e,error:t}=await h.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});if(t)throw t},p=async()=>{let{error:e}=await h.auth.signOut();if(e)throw e},y=(null==i?void 0:i.role)==="admin";return(0,n.jsx)(s.Provider,{value:{user:r,profile:i,loading:u,signUp:x,signIn:f,signInWithGoogle:g,signOut:p,isAdmin:y},children:t})}function i(){let e=(0,a.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},96648:(e,t,r)=>{r.d(t,{U:()=>l});var n=r(55417);let a=null;function l(){return a||(a=(0,n.createBrowserClient)("https://ejdwrepyuznanwujidai.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVqZHdyZXB5dXpuYW53dWppZGFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzNjk3NTYsImV4cCI6MjA4Mzk0NTc1Nn0.MRJe6csColzMRDpAWa-Ma99noAk6n8SbnXXHP2rNAJ4")),a}}}]);