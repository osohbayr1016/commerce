(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4005],{63:(e,t,r)=>{"use strict";var a=r(7260);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},2503:(e,t,r)=>{"use strict";r.d(t,{CartProvider:()=>h,_:()=>m});var a=r(5155),i=r(2115),s=r(5380);async function n(e){try{for(let t of e)await l(t.id,t.quantity,t.size)}catch(e){}}async function o(){try{let e=await fetch("/api/cart");if(!e.ok)return[];return(await e.json()).items||[]}catch(e){return[]}}async function l(e,t,r){try{return(await fetch("/api/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:e,quantity:t,size:r||null})})).ok}catch(e){return!1}}async function c(e,t,r){try{return(await fetch("/api/cart",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:e,quantity:t,size:r||null})})).ok}catch(e){return!1}}async function u(e,t){try{let r=new URL("/api/cart",window.location.origin);return r.searchParams.set("product_id",e),t&&r.searchParams.set("size",t.toString()),(await fetch(r.toString(),{method:"DELETE"})).ok}catch(e){return!1}}let d=(0,i.createContext)(void 0);function h(e){let{children:t}=e,{user:r}=(0,s.A)(),[h,m]=(0,i.useState)([]),[f,x]=(0,i.useState)(!1),y=(0,i.useRef)(null),g=(0,i.useRef)(!0),p=r?"cart:".concat(r.id):null;(0,i.useEffect)(()=>{if(!r||!p)return void m([]);(async()=>{x(!0);try{let e=await o(),t=localStorage.getItem(p),r=t?JSON.parse(t):[],a=[...e];r.forEach(e=>{a.find(t=>t.id===e.id&&t.size===e.size)||a.push(e)}),m(a),localStorage.setItem(p,JSON.stringify(a)),r.length>0&&e.length!==a.length&&await n(a)}catch(t){let e=localStorage.getItem(p);m(e?JSON.parse(e):[])}finally{x(!1),g.current=!1}})()},[r,p]),(0,i.useEffect)(()=>{p&&!g.current&&localStorage.setItem(p,JSON.stringify(h))},[h,p]),(0,i.useEffect)(()=>{if(r&&p&&!g.current)return y.current&&clearTimeout(y.current),y.current=setTimeout(async()=>{x(!0);try{for(let e of h)await l(e.id,e.quantity,e.size)}catch(e){}finally{x(!1)}},1e3),()=>{y.current&&clearTimeout(y.current)}},[h,r,p]);let w=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!r)return{ok:!1};try{let r=await fetch("/api/products/".concat(e.id,"/stock"));if(r.ok){var a;let i=await r.json(),s=((null==(a=h.find(t=>t.id===e.id&&t.size===e.size))?void 0:a.quantity)||0)+t;if(i.stock<s)return{ok:!1,error:0===i.stock?"Бэлэн бараа байхгүй":"Зөвхөн ".concat(i.stock," ширхэг үлдсэн")}}}catch(e){}m(r=>r.find(t=>t.id===e.id&&t.size===e.size)?r.map(r=>r.id===e.id&&r.size===e.size?{...r,quantity:r.quantity+t}:r):[...r,{...e,quantity:t}]);try{await l(e.id,t,e.size)}catch(e){}return{ok:!0}},b=async(e,t)=>{let r=Math.max(1,t),a=h.find(t=>t.id===e);try{let t=await fetch("/api/products/".concat(e,"/stock"));if(t.ok){let i=await t.json();if(i.stock<r){let t=Math.min(i.stock,r);m(r=>r.map(r=>r.id===e?{...r,quantity:t}:r)),a&&await c(e,t,a.size);return}}}catch(e){}if(m(t=>t.map(t=>t.id===e?{...t,quantity:r}:t)),a)try{await c(e,r,a.size)}catch(e){}},v=async e=>{let t=h.find(t=>t.id===e);if(m(t=>t.filter(t=>t.id!==e)),t)try{await u(e,t.size)}catch(e){}},j=async()=>{if(r)try{for(let e of h)await u(e.id,e.size)}catch(e){}m([])},N=(0,i.useMemo)(()=>h.reduce((e,t)=>e+t.price*t.quantity,0),[h]),k=(0,i.useMemo)(()=>h.reduce((e,t)=>e+t.quantity,0),[h]);return(0,a.jsx)(d.Provider,{value:{items:h,subtotal:N,totalItems:k,addItem:w,updateQuantity:b,removeItem:v,clearCart:j,syncing:f},children:t})}function m(){let e=(0,i.useContext)(d);if(!e)throw Error("useCart must be used within a CartProvider");return e}},4816:(e,t,r)=>{Promise.resolve().then(r.bind(r,9032))},5380:(e,t,r)=>{"use strict";r.d(t,{A:()=>l,AuthProvider:()=>o});var a=r(5155),i=r(2115),s=r(6648);let n=(0,i.createContext)(void 0);function o(e){let{children:t}=e,[r,o]=(0,i.useState)(null),[l,c]=(0,i.useState)(null),[u,d]=(0,i.useState)(!0),h=(0,s.U)();(0,i.useEffect)(()=>{h.auth.getSession().then(e=>{var t;let{data:{session:r}}=e;o(null!=(t=null==r?void 0:r.user)?t:null),(null==r?void 0:r.user)?m(r.user.id):d(!1)});let{data:{subscription:e}}=h.auth.onAuthStateChange((e,t)=>{var r;o(null!=(r=null==t?void 0:t.user)?r:null),(null==t?void 0:t.user)?m(t.user.id):(c(null),d(!1))});return()=>e.unsubscribe()},[]);let m=async e=>{try{let{data:t,error:r}=await h.from("profiles").select("*").eq("id",e).single();if(r)throw r;c(t)}catch(e){}finally{d(!1)}},f=async(e,t,r,a)=>{let i=t.replace(/[^0-9]/g,""),{data:s,error:n}=await h.auth.signUp({email:e,password:r,options:{data:{full_name:a||"",phone_number:i},emailRedirectTo:void 0}});if(n){if(n.message.includes("Signups not allowed"))throw Error('Бүртгэл идэвхгүй байна. Суpabase dashboard-аас "Enable email signups" асаах шаардлагатай. Authentication → Providers → Email → Enable email signups');throw n}s.user&&(o(s.user),await m(s.user.id))},x=async(e,t)=>{let r;if(e.includes("@"))r=e.trim();else{let t=e.replace(/[^0-9]/g,"");if(!t||t.length<8)throw Error("Утасны дугаар буруу байна");let{data:a,error:i}=await h.from("profiles").select("email").eq("phone_number",t).single();if(i)throw Error("Утасны дугаараар бүртгэл олдсонгүй. И-мэйл ашиглана уу.");if(!(null==a?void 0:a.email))throw Error("Бүртгэлийн мэдээлэл дутуу байна. Та дахин бүртгүүлнэ үү.");r=a.email}let{data:a,error:i}=await h.auth.signInWithPassword({email:r,password:t});if(i)throw i},y=async()=>{let{data:e,error:t}=await h.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});if(t)throw t},g=async()=>{let{error:e}=await h.auth.signOut();if(e)throw e},p=(null==l?void 0:l.role)==="admin";return(0,a.jsx)(n.Provider,{value:{user:r,profile:l,loading:u,signUp:f,signIn:x,signInWithGoogle:y,signOut:g,isAdmin:p},children:t})}function l(){let e=(0,i.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},8376:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var a=r(5155);function i(e){let{icon:t,title:r,description:i,action:s}=e;return(0,a.jsxs)("div",{className:"text-center py-16 px-4",children:[t&&(0,a.jsx)("div",{className:"mb-6 flex justify-center",children:t}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:r}),i&&(0,a.jsx)("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:i}),s&&(0,a.jsx)("button",{onClick:s.onClick,className:"inline-flex items-center px-6 py-3 bg-gray-900 text-white rounded-lg font-medium hover:bg-gray-800 transition-colors",children:s.label})]})}},9032:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var a=r(5155),i=r(2115),s=r(63),n=r(4673),o=r(5042),l=r(4269);function c(e){let{item:t,onIncrease:r,onDecrease:i,onRemove:s}=e;return(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4 border border-gray-200 rounded-lg p-4",children:[(0,a.jsx)("div",{className:"w-20 h-20 rounded-lg border border-gray-200 bg-gray-50",style:{backgroundColor:t.imageColor||"#FAFAFA"}}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("a",{href:"/products/".concat(t.slug),className:"text-gray-900 font-medium",children:t.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[(0,l.$)(t.price)," ₮"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("button",{onClick:i,className:"w-9 h-9 rounded-full border border-gray-300 text-gray-700 hover:border-gray-400",children:"-"}),(0,a.jsx)("span",{className:"w-6 text-center text-sm font-medium",children:t.quantity}),(0,a.jsx)("button",{onClick:r,className:"w-9 h-9 rounded-full border border-gray-300 text-gray-700 hover:border-gray-400",children:"+"})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Дүн"}),(0,a.jsxs)("p",{className:"text-base font-semibold text-gray-900",children:[(0,l.$)(t.price*t.quantity)," ₮"]}),(0,a.jsx)("button",{onClick:s,className:"mt-2 text-xs text-gray-500 hover:text-gray-900",children:"Устгах"})]})]})}var u=r(8376),d=r(5380),h=r(2503);function m(){let{user:e,loading:t}=(0,d.A)(),{items:r,subtotal:m,updateQuantity:f,removeItem:x,clearCart:y}=(0,h._)(),g=(0,s.useRouter)();return((0,i.useEffect)(()=>{t||e||g.push("/auth/login?redirect=/cart")},[t,e,g]),t)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-white",children:(0,a.jsx)("p",{className:"text-gray-600",children:"Уншиж байна..."})}):(0,a.jsxs)("div",{className:"min-h-screen flex flex-col bg-white",children:[(0,a.jsx)(n.A,{}),(0,a.jsx)("main",{className:"flex-1 py-8 md:py-12",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h1",{className:"text-3xl md:text-4xl font-semibold text-gray-900",children:"Миний сагс"}),r.length>0&&(0,a.jsx)("button",{onClick:y,className:"text-sm text-gray-500 hover:text-gray-900 transition-colors",children:"Бүгдийг устгах"})]}),0===r.length?(0,a.jsx)(u.A,{icon:(0,a.jsx)("svg",{className:"w-24 h-24 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),title:"Сагс хоосон байна",description:"Сагсанд бүтээгдэхүүн нэмээд захиалга өгөх боломжтой",action:{label:"Дэлгүүр хэсэх",onClick:()=>g.push("/")}}):(0,a.jsxs)("div",{className:"space-y-4",children:[r.map(e=>(0,a.jsx)(c,{item:e,onIncrease:()=>f(e.id,e.quantity+1),onDecrease:()=>f(e.id,e.quantity-1),onRemove:()=>x(e.id)},e.id)),(0,a.jsxs)("div",{className:"border-t border-gray-200 pt-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Нийт үнэ:"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[(0,l.$)(m)," ₮"]})]}),(0,a.jsx)("button",{onClick:()=>g.push("/checkout"),className:"rounded-lg bg-black px-8 py-3 text-white text-base font-medium hover:bg-gray-800 transition-colors",children:"Үргэлжлүүлэх"})]})]})]})}),(0,a.jsx)(o.A,{})]})}}},e=>{e.O(0,[5417,1891,8441,1255,7358],()=>e(e.s=4816)),_N_E=e.O()}]);