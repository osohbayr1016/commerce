(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4005],{1935:(e,t,r)=>{"use strict";r.d(t,{default:()=>s});var i=r(95155),a=r(20063),n=r(18747);function s(e){let{href:t,className:r=""}=e,s=(0,a.useRouter)(),{t:l}=(0,n.o)();return(0,i.jsxs)("button",{onClick:()=>{t?s.push(t):s.back()},className:"inline-flex items-center gap-2 text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors ".concat(r),children:[(0,i.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),l("common.back")||"Back"]})}},29032:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var i=r(95155),a=r(12115),n=r(20063),s=r(26424),l=r(5042),o=r(64269);function c(e){let{item:t,onIncrease:r,onDecrease:a,onRemove:n}=e;return(0,i.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4 border border-gray-200 rounded-lg p-4",children:[(0,i.jsx)("div",{className:"w-20 h-20 rounded-lg border border-gray-200 bg-gray-50",style:{backgroundColor:t.imageColor||"#FAFAFA"}}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("a",{href:"/products/".concat(t.slug),className:"text-gray-900 font-medium",children:t.name}),(0,i.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[(0,o.$)(t.price)," ₮"]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)("button",{onClick:a,className:"w-9 h-9 rounded-full border border-gray-300 text-gray-700 hover:border-gray-400",children:"-"}),(0,i.jsx)("span",{className:"w-6 text-center text-sm font-medium",children:t.quantity}),(0,i.jsx)("button",{onClick:r,className:"w-9 h-9 rounded-full border border-gray-300 text-gray-700 hover:border-gray-400",children:"+"})]}),(0,i.jsxs)("div",{className:"text-right",children:[(0,i.jsx)("p",{className:"text-sm text-gray-500",children:"Дүн"}),(0,i.jsxs)("p",{className:"text-base font-semibold text-gray-900",children:[(0,o.$)(t.price*t.quantity)," ₮"]}),(0,i.jsx)("button",{onClick:n,className:"mt-2 text-xs text-gray-500 hover:text-gray-900",children:"Устгах"})]})]})}var u=r(88376),d=r(1935),h=r(65380),f=r(52503);function m(){let{user:e,loading:t}=(0,h.A)(),{items:r,subtotal:m,updateQuantity:x,removeItem:y,clearCart:g}=(0,f._)(),p=(0,n.useRouter)();return((0,a.useEffect)(()=>{t||e||p.push("/auth/login?redirect=/cart")},[t,e,p]),t)?(0,i.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-white",children:(0,i.jsx)("p",{className:"text-gray-600",children:"Уншиж байна..."})}):(0,i.jsxs)("div",{className:"min-h-screen flex flex-col bg-white",children:[(0,i.jsx)(s.A,{}),(0,i.jsx)("main",{className:"flex-1 py-8 md:py-12",children:(0,i.jsxs)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,i.jsx)("div",{className:"mb-6",children:(0,i.jsx)(d.default,{})}),(0,i.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,i.jsx)("h1",{className:"text-3xl md:text-4xl font-semibold text-gray-900",children:"Миний сагс"}),r.length>0&&(0,i.jsx)("button",{onClick:g,className:"text-sm text-gray-500 hover:text-gray-900 transition-colors",children:"Бүгдийг устгах"})]}),0===r.length?(0,i.jsx)(u.A,{icon:(0,i.jsx)("svg",{className:"w-24 h-24 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),title:"Сагс хоосон байна",description:"Сагсанд бүтээгдэхүүн нэмээд захиалга өгөх боломжтой",action:{label:"Дэлгүүр хэсэх",onClick:()=>p.push("/")}}):(0,i.jsxs)("div",{className:"space-y-4",children:[r.map(e=>(0,i.jsx)(c,{item:e,onIncrease:()=>x(e.id,e.quantity+1),onDecrease:()=>x(e.id,e.quantity-1),onRemove:()=>y(e.id)},e.id)),(0,i.jsxs)("div",{className:"border-t border-gray-200 pt-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Нийт үнэ:"}),(0,i.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[(0,o.$)(m)," ₮"]})]}),(0,i.jsx)("button",{onClick:()=>p.push("/checkout"),className:"rounded-lg bg-black px-8 py-3 text-white text-base font-medium hover:bg-gray-800 transition-colors",children:"Үргэлжлүүлэх"})]})]})]})}),(0,i.jsx)(l.A,{})]})}},52503:(e,t,r)=>{"use strict";r.d(t,{CartProvider:()=>h,_:()=>f});var i=r(95155),a=r(12115),n=r(65380);async function s(e){try{for(let t of e)await o(t.id,t.quantity,t.size)}catch(e){}}async function l(){try{let e=await fetch("/api/cart");if(!e.ok)return[];return(await e.json()).items||[]}catch(e){return[]}}async function o(e,t,r){try{return(await fetch("/api/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:e,quantity:t,size:r||null})})).ok}catch(e){return!1}}async function c(e,t,r){try{return(await fetch("/api/cart",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:e,quantity:t,size:r||null})})).ok}catch(e){return!1}}async function u(e,t){try{let r=new URL("/api/cart",window.location.origin);return r.searchParams.set("product_id",e),t&&r.searchParams.set("size",t.toString()),(await fetch(r.toString(),{method:"DELETE"})).ok}catch(e){return!1}}let d=(0,a.createContext)(void 0);function h(e){let{children:t}=e,{user:r}=(0,n.A)(),[h,f]=(0,a.useState)([]),[m,x]=(0,a.useState)(!1),y=(0,a.useRef)(null),g=(0,a.useRef)(!0),p=r?"cart:".concat(r.id):null;(0,a.useEffect)(()=>{if(!r||!p)return void f([]);(async()=>{x(!0);try{let e=await l(),t=localStorage.getItem(p),r=t?JSON.parse(t):[],i=[...e];r.forEach(e=>{i.find(t=>t.id===e.id&&t.size===e.size)||i.push(e)}),f(i),localStorage.setItem(p,JSON.stringify(i)),r.length>0&&e.length!==i.length&&await s(i)}catch(t){let e=localStorage.getItem(p);f(e?JSON.parse(e):[])}finally{x(!1),g.current=!1}})()},[r,p]),(0,a.useEffect)(()=>{p&&!g.current&&localStorage.setItem(p,JSON.stringify(h))},[h,p]),(0,a.useEffect)(()=>{if(r&&p&&!g.current)return y.current&&clearTimeout(y.current),y.current=setTimeout(async()=>{x(!0);try{for(let e of h)await o(e.id,e.quantity,e.size)}catch(e){}finally{x(!1)}},1e3),()=>{y.current&&clearTimeout(y.current)}},[h,r,p]);let b=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!r)return{ok:!1};try{let r=await fetch("/api/products/".concat(e.id,"/stock"));if(r.ok){var i;let a=await r.json(),n=((null==(i=h.find(t=>t.id===e.id&&t.size===e.size))?void 0:i.quantity)||0)+t;if(a.stock<n)return{ok:!1,error:0===a.stock?"Бэлэн бараа байхгүй":"Зөвхөн ".concat(a.stock," ширхэг үлдсэн")}}}catch(e){}f(r=>r.find(t=>t.id===e.id&&t.size===e.size)?r.map(r=>r.id===e.id&&r.size===e.size?{...r,quantity:r.quantity+t}:r):[...r,{...e,quantity:t}]);try{await o(e.id,t,e.size)}catch(e){}return{ok:!0}},w=async(e,t)=>{let r=Math.max(1,t),i=h.find(t=>t.id===e);try{let t=await fetch("/api/products/".concat(e,"/stock"));if(t.ok){let a=await t.json();if(a.stock<r){let t=Math.min(a.stock,r);f(r=>r.map(r=>r.id===e?{...r,quantity:t}:r)),i&&await c(e,t,i.size);return}}}catch(e){}if(f(t=>t.map(t=>t.id===e?{...t,quantity:r}:t)),i)try{await c(e,r,i.size)}catch(e){}},v=async e=>{let t=h.find(t=>t.id===e);if(f(t=>t.filter(t=>t.id!==e)),t)try{await u(e,t.size)}catch(e){}},j=async()=>{if(r)try{for(let e of h)await u(e.id,e.size)}catch(e){}f([])},k=(0,a.useMemo)(()=>h.reduce((e,t)=>e+t.price*t.quantity,0),[h]),N=(0,a.useMemo)(()=>h.reduce((e,t)=>e+t.quantity,0),[h]);return(0,i.jsx)(d.Provider,{value:{items:h,subtotal:k,totalItems:N,addItem:b,updateQuantity:w,removeItem:v,clearCart:j,syncing:m},children:t})}function f(){let e=(0,a.useContext)(d);if(!e)throw Error("useCart must be used within a CartProvider");return e}},65380:(e,t,r)=>{"use strict";r.d(t,{A:()=>o,AuthProvider:()=>l});var i=r(95155),a=r(12115),n=r(96648);let s=(0,a.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,a.useState)(null),[o,c]=(0,a.useState)(null),[u,d]=(0,a.useState)(!0),h=(0,n.U)();(0,a.useEffect)(()=>{h.auth.getSession().then(e=>{var t;let{data:{session:r}}=e;l(null!=(t=null==r?void 0:r.user)?t:null),(null==r?void 0:r.user)?f(r.user.id):d(!1)});let{data:{subscription:e}}=h.auth.onAuthStateChange((e,t)=>{var r;l(null!=(r=null==t?void 0:t.user)?r:null),(null==t?void 0:t.user)?f(t.user.id):(c(null),d(!1))});return()=>e.unsubscribe()},[]);let f=async e=>{try{let{data:t,error:r}=await h.from("profiles").select("*").eq("id",e).single();if(r)throw r;c(t)}catch(e){}finally{d(!1)}},m=async(e,t,r,i)=>{let a=t.replace(/[^0-9]/g,""),{data:n,error:s}=await h.auth.signUp({email:e,password:r,options:{data:{full_name:i||"",phone_number:a},emailRedirectTo:void 0}});if(s){if(s.message.includes("Signups not allowed"))throw Error('Бүртгэл идэвхгүй байна. Суpabase dashboard-аас "Enable email signups" асаах шаардлагатай. Authentication → Providers → Email → Enable email signups');throw s}n.user&&(l(n.user),await f(n.user.id))},x=async(e,t)=>{let r;if(e.includes("@"))r=e.trim();else{let t=e.replace(/[^0-9]/g,"");if(!t||t.length<8)throw Error("Утасны дугаар буруу байна");let{data:i,error:a}=await h.from("profiles").select("email").eq("phone_number",t).single();if(a)throw Error("Утасны дугаараар бүртгэл олдсонгүй. И-мэйл ашиглана уу.");if(!(null==i?void 0:i.email))throw Error("Бүртгэлийн мэдээлэл дутуу байна. Та дахин бүртгүүлнэ үү.");r=i.email}let{data:i,error:a}=await h.auth.signInWithPassword({email:r,password:t});if(a)throw a},y=async()=>{let{data:e,error:t}=await h.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});if(t)throw t},g=async()=>{let{error:e}=await h.auth.signOut();if(e)throw e},p=(null==o?void 0:o.role)==="admin";return(0,i.jsx)(s.Provider,{value:{user:r,profile:o,loading:u,signUp:m,signIn:x,signInWithGoogle:y,signOut:g,isAdmin:p},children:t})}function o(){let e=(0,a.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},74816:(e,t,r)=>{Promise.resolve().then(r.bind(r,29032))},83011:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return a}});let i=r(12115);function a(e,t){let r=(0,i.useRef)(null),a=(0,i.useRef)(null);return(0,i.useCallback)(i=>{if(null===i){let e=r.current;e&&(r.current=null,e());let t=a.current;t&&(a.current=null,t())}else e&&(r.current=n(e,i)),t&&(a.current=n(t,i))},[e,t])}function n(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let r=e(t);return"function"==typeof r?r:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},88376:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var i=r(95155);function a(e){let{icon:t,title:r,description:a,action:n}=e;return(0,i.jsxs)("div",{className:"text-center py-16 px-4",children:[t&&(0,i.jsx)("div",{className:"mb-6 flex justify-center",children:t}),(0,i.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:r}),a&&(0,i.jsx)("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:a}),n&&(0,i.jsx)("button",{onClick:n.onClick,className:"inline-flex items-center px-6 py-3 bg-gray-900 text-white rounded-lg font-medium hover:bg-gray-800 transition-colors",children:n.label})]})}}},e=>{e.O(0,[1500,5417,6394,8747,8096,8441,1255,7358],()=>e(e.s=74816)),_N_E=e.O()}]);