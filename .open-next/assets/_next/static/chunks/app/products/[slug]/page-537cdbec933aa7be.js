(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[221],{63:(e,r,t)=>{"use strict";var s=t(7260);t.o(s,"usePathname")&&t.d(r,{usePathname:function(){return s.usePathname}}),t.o(s,"useRouter")&&t.d(r,{useRouter:function(){return s.useRouter}}),t.o(s,"useSearchParams")&&t.d(r,{useSearchParams:function(){return s.useSearchParams}})},289:(e,r,t)=>{"use strict";t.d(r,{default:()=>i});var s=t(5155),a=t(63),n=t(4269),l=t(5380),o=t(7740);function i(e){let{product:r}=e,{user:t}=(0,l.A)(),{addItem:i}=(0,o._)(),c=(0,a.useRouter)(),d=(0,a.usePathname)(),u=r.description||"Манай дэлгүүр АНУ-аас бараагаа илгээдэг тул захиалга баталгаажсаны дараа 10–14 хоногийн дотор Монголд очих бөгөөд каргоны төлбөрийг тусад нь төлөхийг анхаарна уу.",m=e=>{if(!t)return void c.push("/auth/login?redirect=".concat(encodeURIComponent(d)));i({id:String(r.id),name:r.nameEn,price:r.price,originalPrice:r.originalPrice,quantity:1,slug:r.slug,brand:r.brand,imageColor:r.imageColor,brandColor:r.brandColor}),e&&c.push("/checkout")};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[r.brand&&(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["brand ",r.brand]}),(0,s.jsx)("h1",{className:"text-3xl md:text-4xl font-semibold text-gray-900 mt-2",children:r.nameEn})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("span",{className:"text-3xl md:text-4xl font-semibold text-gray-900",children:[(0,n.$)(r.price)," ₮"]}),r.discount>0&&(0,s.jsxs)("span",{className:"text-sm text-gray-500 line-through",children:[(0,n.$)(r.originalPrice)," ₮"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[r.discount>0&&(0,s.jsxs)("span",{className:"rounded-full bg-gray-100 px-2 py-1 text-gray-700",children:["-",r.discount,"%"]}),r.savings>0&&(0,s.jsxs)("span",{className:"text-gray-500",children:["Хэмнэлт: ",(0,n.$)(r.savings)," ₮"]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Богино тайлбар"}),(0,s.jsx)("p",{className:"text-sm md:text-base text-gray-600 leading-relaxed",children:u})]}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[(0,s.jsx)("button",{onClick:()=>m(!1),className:"flex-1 rounded-lg bg-gray-900 px-6 py-3 text-white text-base font-medium hover:bg-gray-800",children:"Сагслах"}),(0,s.jsx)("button",{onClick:()=>m(!0),className:"flex-1 rounded-lg border border-gray-900 px-6 py-3 text-gray-900 text-base font-medium hover:bg-gray-50",children:"Захиалах"})]})]})}},2436:(e,r,t)=>{"use strict";t.d(r,{default:()=>o});var s=t(5155),a=t(63),n=t(5380),l=t(7740);function o(e){let{product:r,slug:t}=e,{user:o}=(0,n.A)(),{addItem:i}=(0,l._)(),c=(0,a.useRouter)(),d=(0,a.usePathname)();return(0,s.jsx)("button",{onClick:()=>{if(!o)return void c.push("/auth/login?redirect=".concat(encodeURIComponent(d)));r.id&&i({id:String(r.id||""),name:r.nameEn,price:r.price,originalPrice:r.originalPrice,quantity:1,slug:t,brand:r.brand,imageColor:r.imageColor,brandColor:r.brandColor})},className:"w-full rounded-full border border-gray-200 px-3 py-2 text-xs text-gray-700 hover:border-gray-300 hover:text-gray-900",children:"Сагслах"})}},2442:(e,r,t)=>{"use strict";t.d(r,{default:()=>n});var s=t(5155),a=t(2115);function n(e){let{images:r,imageColor:t,productName:n}=e,[l,o]=(0,a.useState)(0),i=r.length||1;return(0,s.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,s.jsx)("div",{className:"flex flex-row md:flex-col gap-2 order-2 md:order-1",children:r.map((e,r)=>(0,s.jsx)("button",{onClick:()=>o(r),className:"w-16 h-16 md:w-20 md:h-20 rounded border-2 transition-all overflow-hidden ".concat(l===r?"border-gray-900":"border-gray-200 hover:border-gray-400"),style:{backgroundColor:t},"aria-label":"View image ".concat(r+1),children:e?(0,s.jsx)("img",{src:e,alt:"".concat(n," ").concat(r+1),className:"w-full h-full object-cover"}):null},r))}),(0,s.jsx)("div",{className:"flex-1 order-1 md:order-2",children:(0,s.jsx)("div",{className:"w-full aspect-square rounded-lg border border-gray-200 bg-gray-50 flex items-center justify-center relative overflow-hidden",style:{backgroundColor:t},children:r[l]?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("img",{src:r[l],alt:n||"Product Image",className:"w-full h-full object-cover"}),(0,s.jsxs)("span",{className:"absolute top-3 right-3 text-xs text-white bg-black bg-opacity-50 px-2 py-1 rounded",children:[l+1," of ",i]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("span",{className:"absolute top-3 right-3 text-xs text-gray-500",children:[l+1," of ",i]}),(0,s.jsx)("span",{className:"text-gray-400 text-sm",children:n||"Product Image"})]})})})]})}},4001:(e,r,t)=>{"use strict";t.d(r,{default:()=>c});var s=t(5155),a=t(2115),n=t(2619),l=t.n(n),o=t(63),i=t(5380);function c(){var e,r,t,n;let[c,d]=(0,a.useState)(!1),u=(0,a.useRef)(null),{user:m,profile:h,signOut:x,isAdmin:g}=(0,i.A)(),p=(0,o.useRouter)();(0,a.useEffect)(()=>{function e(e){u.current&&!u.current.contains(e.target)&&d(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let f=async()=>{try{await x(),d(!1),p.push("/")}catch(e){console.error("Error signing out:",e)}};return m?(0,s.jsxs)("div",{className:"relative",ref:u,children:[(0,s.jsxs)("button",{onClick:()=>d(!c),className:"flex items-center space-x-2 text-gray-700 hover:text-gray-900",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-900 flex items-center justify-center text-white font-medium text-sm",children:(null==h||null==(r=h.full_name)||null==(e=r[0])?void 0:e.toUpperCase())||"U"}),(0,s.jsx)("svg",{className:"w-4 h-4 transition-transform ".concat(c?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),c&&(0,s.jsxs)("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50",children:[(0,s.jsxs)("div",{className:"px-4 py-3 border-b border-gray-200",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900",children:(null==h?void 0:h.full_name)||"Хэрэглэгч"}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:(null==(t=m.user_metadata)?void 0:t.phone_number)||m.phone||(null==(n=m.email)?void 0:n.replace("@phone.app",""))}),g&&(0,s.jsx)("span",{className:"inline-block mt-2 px-2 py-1 text-xs font-medium bg-gray-900 text-white rounded",children:"Админ"})]}),(0,s.jsxs)("div",{className:"py-2",children:[(0,s.jsx)(l(),{href:"/profile",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>d(!1),children:"\uD83D\uDC64 Миний профайл"}),(0,s.jsx)(l(),{href:"/profile?tab=orders",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>d(!1),children:"\uD83D\uDCE6 Миний захиалга"}),(0,s.jsx)(l(),{href:"/profile?tab=wishlist",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>d(!1),children:"❤️ Хадгалсан"}),g&&(0,s.jsx)(l(),{href:"/admin",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>d(!1),children:"Админ самбар"})]}),(0,s.jsx)("div",{className:"border-t border-gray-200 pt-2",children:(0,s.jsx)("button",{onClick:f,className:"block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50",children:"Гарах"})})]})]}):(0,s.jsx)(l(),{href:"/auth/login",className:"text-gray-700 hover:text-gray-900 text-sm md:text-base whitespace-nowrap font-medium",children:"нэвтрэх/бүртгүүлэх"})}},4269:(e,r,t)=>{"use strict";function s(e){return new Intl.NumberFormat("mn-MN").format(e)}t.d(r,{$:()=>s})},5380:(e,r,t)=>{"use strict";t.d(r,{A:()=>i,AuthProvider:()=>o});var s=t(5155),a=t(2115),n=t(6648);let l=(0,a.createContext)(void 0);function o(e){let{children:r}=e,[t,o]=(0,a.useState)(null),[i,c]=(0,a.useState)(null),[d,u]=(0,a.useState)(!0),m=(0,n.U)();(0,a.useEffect)(()=>{m.auth.getSession().then(e=>{var r;let{data:{session:t}}=e;o(null!=(r=null==t?void 0:t.user)?r:null),(null==t?void 0:t.user)?h(t.user.id):u(!1)});let{data:{subscription:e}}=m.auth.onAuthStateChange((e,r)=>{var t;o(null!=(t=null==r?void 0:r.user)?t:null),(null==r?void 0:r.user)?h(r.user.id):(c(null),u(!1))});return()=>e.unsubscribe()},[]);let h=async e=>{try{let{data:r,error:t}=await m.from("profiles").select("*").eq("id",e).single();if(t)throw t;c(r)}catch(e){console.error("Error fetching profile:",e)}finally{u(!1)}},x=async(e,r,t,s)=>{let a=r.replace(/[^0-9]/g,"");console.log("Attempting signup with:",{email:e,phone:a});let{data:n,error:l}=await m.auth.signUp({email:e,password:t,options:{data:{full_name:s||"",phone_number:a},emailRedirectTo:void 0}});if(l){if(console.error("Signup error:",l),l.message.includes("Signups not allowed"))throw Error('Бүртгэл идэвхгүй байна. Суpabase dashboard-аас "Enable email signups" асаах шаардлагатай. Authentication → Providers → Email → Enable email signups');throw l}console.log("Signup successful:",n),n.user&&(o(n.user),await h(n.user.id))},g=async(e,r)=>{let t;if(e.includes("@"))console.log("Login with email:",t=e.trim());else{let r=e.replace(/[^0-9]/g,"");if(console.log("Login with phone:",r),!r||r.length<8)throw Error("Утасны дугаар буруу байна");let{data:s,error:a}=await m.from("profiles").select("email").eq("phone_number",r).single();if(console.log("Profile lookup result:",{profile:s,profileError:a}),a)throw console.error("Profile lookup error:",a),Error("Утасны дугаараар бүртгэл олдсонгүй. И-мэйл ашиглана уу.");if(!(null==s?void 0:s.email))throw Error("Бүртгэлийн мэдээлэл дутуу байна. Та дахин бүртгүүлнэ үү.");console.log("Using email from profile:",t=s.email)}let{data:s,error:a}=await m.auth.signInWithPassword({email:t,password:r});if(a)throw console.error("Supabase auth error:",a),a;console.log("Login successful!")},p=async()=>{let{data:e,error:r}=await m.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});if(r)throw r},f=async()=>{let{error:e}=await m.auth.signOut();if(e)throw e},b=(null==i?void 0:i.role)==="admin";return(0,s.jsx)(l.Provider,{value:{user:t,profile:i,loading:d,signUp:x,signIn:g,signInWithGoogle:p,signOut:f,isAdmin:b},children:r})}function i(){let e=(0,a.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},6648:(e,r,t)=>{"use strict";t.d(r,{U:()=>a});var s=t(5417);function a(){return(0,s.createBrowserClient)("https://ejdwrepyuznanwujidai.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVqZHdyZXB5dXpuYW53dWppZGFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzNjk3NTYsImV4cCI6MjA4Mzk0NTc1Nn0.MRJe6csColzMRDpAWa-Ma99noAk6n8SbnXXHP2rNAJ4")}},7740:(e,r,t)=>{"use strict";t.d(r,{CartProvider:()=>o,_:()=>i});var s=t(5155),a=t(2115),n=t(5380);let l=(0,a.createContext)(void 0);function o(e){let{children:r}=e,{user:t}=(0,n.A)(),[o,i]=(0,a.useState)([]),c=t?"cart:".concat(t.id):null;(0,a.useEffect)(()=>{if(!c)return void i([]);let e=localStorage.getItem(c);i(e?JSON.parse(e):[])},[c]),(0,a.useEffect)(()=>{c&&localStorage.setItem(c,JSON.stringify(o))},[o,c]);let d=(0,a.useMemo)(()=>o.reduce((e,r)=>e+r.price*r.quantity,0),[o]),u=(0,a.useMemo)(()=>o.reduce((e,r)=>e+r.quantity,0),[o]);return(0,s.jsx)(l.Provider,{value:{items:o,subtotal:d,totalItems:u,addItem:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t?(i(t=>t.find(r=>r.id===e.id)?t.map(t=>t.id===e.id?{...t,quantity:t.quantity+r}:t):[...t,{...e,quantity:r}]),{ok:!0}):{ok:!1}},updateQuantity:(e,r)=>{i(t=>t.map(t=>t.id===e?{...t,quantity:Math.max(1,r)}:t))},removeItem:e=>{i(r=>r.filter(r=>r.id!==e))},clearCart:()=>{i([])}},children:r})}function i(){let e=(0,a.useContext)(l);if(!e)throw Error("useCart must be used within a CartProvider");return e}},9851:(e,r,t)=>{Promise.resolve().then(t.bind(t,4001)),Promise.resolve().then(t.bind(t,2442)),Promise.resolve().then(t.bind(t,289)),Promise.resolve().then(t.bind(t,2436))}},e=>{e.O(0,[417,619,441,493,358],()=>e(e.s=9851)),_N_E=e.O()}]);