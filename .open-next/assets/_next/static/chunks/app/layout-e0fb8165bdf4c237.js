(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{3673:()=>{},3973:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2619,23)),Promise.resolve().then(r.t.bind(r,4635,23)),Promise.resolve().then(r.t.bind(r,8615,23)),Promise.resolve().then(r.t.bind(r,3673,23)),Promise.resolve().then(r.bind(r,5380)),Promise.resolve().then(r.bind(r,7740))},4635:e=>{e.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_188709",variable:"__variable_188709"}},5380:(e,t,r)=>{"use strict";r.d(t,{A:()=>s,AuthProvider:()=>n});var i=r(5155),o=r(2115),l=r(6648);let a=(0,o.createContext)(void 0);function n(e){let{children:t}=e,[r,n]=(0,o.useState)(null),[s,u]=(0,o.useState)(null),[c,d]=(0,o.useState)(!0),h=(0,l.U)();(0,o.useEffect)(()=>{h.auth.getSession().then(e=>{var t;let{data:{session:r}}=e;n(null!=(t=null==r?void 0:r.user)?t:null),(null==r?void 0:r.user)?m(r.user.id):d(!1)});let{data:{subscription:e}}=h.auth.onAuthStateChange((e,t)=>{var r;n(null!=(r=null==t?void 0:t.user)?r:null),(null==t?void 0:t.user)?m(t.user.id):(u(null),d(!1))});return()=>e.unsubscribe()},[]);let m=async e=>{try{let{data:t,error:r}=await h.from("profiles").select("*").eq("id",e).single();if(r)throw r;u(t)}catch(e){console.error("Error fetching profile:",e)}finally{d(!1)}},f=async(e,t,r,i)=>{let o=t.replace(/[^0-9]/g,""),{data:l,error:a}=await h.auth.signUp({email:e,password:r,options:{data:{full_name:i||"",phone_number:o},emailRedirectTo:void 0}});if(a)throw a;l.user&&(n(l.user),await m(l.user.id))},p=async(e,t)=>{let r;if(e.includes("@"))console.log("Login with email:",r=e.trim());else{let t=e.replace(/[^0-9]/g,"");if(console.log("Login with phone:",t),!t||t.length<8)throw Error("Утасны дугаар буруу байна");let{data:i,error:o}=await h.from("profiles").select("email").eq("phone_number",t).single();if(console.log("Profile lookup result:",{profile:i,profileError:o}),o)throw console.error("Profile lookup error:",o),Error("Утасны дугаараар бүртгэл олдсонгүй. И-мэйл ашиглана уу.");if(!(null==i?void 0:i.email))throw Error("Бүртгэлийн мэдээлэл дутуу байна. Та дахин бүртгүүлнэ үү.");console.log("Using email from profile:",r=i.email)}let{data:i,error:o}=await h.auth.signInWithPassword({email:r,password:t});if(o)throw console.error("Supabase auth error:",o),o;console.log("Login successful!")},v=async()=>{let{data:e,error:t}=await h.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});if(t)throw t},g=async()=>{let{error:e}=await h.auth.signOut();if(e)throw e},w=(null==s?void 0:s.role)==="admin";return(0,i.jsx)(a.Provider,{value:{user:r,profile:s,loading:c,signUp:f,signIn:p,signInWithGoogle:v,signOut:g,isAdmin:w},children:t})}function s(){let e=(0,o.useContext)(a);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},6648:(e,t,r)=>{"use strict";r.d(t,{U:()=>o});var i=r(5417);function o(){let e="https://ejdwrepyuznanwujidai.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVqZHdyZXB5dXpuYW53dWppZGFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzNjk3NTYsImV4cCI6MjA4Mzk0NTc1Nn0.MRJe6csColzMRDpAWa-Ma99noAk6n8SbnXXHP2rNAJ4";return e&&t?(0,i.createBrowserClient)(e,t):(console.error("Missing Supabase environment variables"),(0,i.createBrowserClient)("https://placeholder.supabase.co","placeholder-key"))}},7740:(e,t,r)=>{"use strict";r.d(t,{CartProvider:()=>n,_:()=>s});var i=r(5155),o=r(2115),l=r(5380);let a=(0,o.createContext)(void 0);function n(e){let{children:t}=e,{user:r}=(0,l.A)(),[n,s]=(0,o.useState)([]),u=r?"cart:".concat(r.id):null;(0,o.useEffect)(()=>{if(!u)return void s([]);let e=localStorage.getItem(u);s(e?JSON.parse(e):[])},[u]),(0,o.useEffect)(()=>{u&&localStorage.setItem(u,JSON.stringify(n))},[n,u]);let c=(0,o.useMemo)(()=>n.reduce((e,t)=>e+t.price*t.quantity,0),[n]),d=(0,o.useMemo)(()=>n.reduce((e,t)=>e+t.quantity,0),[n]);return(0,i.jsx)(a.Provider,{value:{items:n,subtotal:c,totalItems:d,addItem:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return r?(s(r=>r.find(t=>t.id===e.id)?r.map(r=>r.id===e.id?{...r,quantity:r.quantity+t}:r):[...r,{...e,quantity:t}]),{ok:!0}):{ok:!1}},updateQuantity:(e,t)=>{s(r=>r.map(r=>r.id===e?{...r,quantity:Math.max(1,t)}:r))},removeItem:e=>{s(t=>t.filter(t=>t.id!==e))},clearCart:()=>{s([])}},children:t})}function s(){let e=(0,o.useContext)(a);if(!e)throw Error("useCart must be used within a CartProvider");return e}},8615:e=>{e.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_9a8899",variable:"__variable_9a8899"}}},e=>{e.O(0,[614,417,619,441,493,358],()=>e(e.s=3973)),_N_E=e.O()}]);