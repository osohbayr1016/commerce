(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[581],{63:(e,r,t)=>{"use strict";var s=t(7260);t.o(s,"usePathname")&&t.d(r,{usePathname:function(){return s.usePathname}}),t.o(s,"useRouter")&&t.d(r,{useRouter:function(){return s.useRouter}}),t.o(s,"useSearchParams")&&t.d(r,{useSearchParams:function(){return s.useSearchParams}})},3630:(e,r,t)=>{Promise.resolve().then(t.bind(t,9208))},5380:(e,r,t)=>{"use strict";t.d(r,{A:()=>i,AuthProvider:()=>n});var s=t(5155),a=t(2115),o=t(6648);let l=(0,a.createContext)(void 0);function n(e){let{children:r}=e,[t,n]=(0,a.useState)(null),[i,c]=(0,a.useState)(null),[d,u]=(0,a.useState)(!0),h=(0,o.U)();(0,a.useEffect)(()=>{h.auth.getSession().then(e=>{var r;let{data:{session:t}}=e;n(null!=(r=null==t?void 0:t.user)?r:null),(null==t?void 0:t.user)?m(t.user.id):u(!1)});let{data:{subscription:e}}=h.auth.onAuthStateChange((e,r)=>{var t;n(null!=(t=null==r?void 0:r.user)?t:null),(null==r?void 0:r.user)?m(r.user.id):(c(null),u(!1))});return()=>e.unsubscribe()},[]);let m=async e=>{try{let{data:r,error:t}=await h.from("profiles").select("*").eq("id",e).single();if(t)throw t;c(r)}catch(e){console.error("Error fetching profile:",e)}finally{u(!1)}},g=async(e,r,t,s)=>{let a=r.replace(/[^0-9]/g,"");console.log("Attempting signup with:",{email:e,phone:a});let{data:o,error:l}=await h.auth.signUp({email:e,password:t,options:{data:{full_name:s||"",phone_number:a},emailRedirectTo:void 0}});if(l){if(console.error("Signup error:",l),l.message.includes("Signups not allowed"))throw Error('Бүртгэл идэвхгүй байна. Суpabase dashboard-аас "Enable email signups" асаах шаардлагатай. Authentication → Providers → Email → Enable email signups');throw l}console.log("Signup successful:",o),o.user&&(n(o.user),await m(o.user.id))},x=async(e,r)=>{let t;if(e.includes("@"))console.log("Login with email:",t=e.trim());else{let r=e.replace(/[^0-9]/g,"");if(console.log("Login with phone:",r),!r||r.length<8)throw Error("Утасны дугаар буруу байна");let{data:s,error:a}=await h.from("profiles").select("email").eq("phone_number",r).single();if(console.log("Profile lookup result:",{profile:s,profileError:a}),a)throw console.error("Profile lookup error:",a),Error("Утасны дугаараар бүртгэл олдсонгүй. И-мэйл ашиглана уу.");if(!(null==s?void 0:s.email))throw Error("Бүртгэлийн мэдээлэл дутуу байна. Та дахин бүртгүүлнэ үү.");console.log("Using email from profile:",t=s.email)}let{data:s,error:a}=await h.auth.signInWithPassword({email:t,password:r});if(a)throw console.error("Supabase auth error:",a),a;console.log("Login successful!")},f=async()=>{let{data:e,error:r}=await h.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});if(r)throw r},p=async()=>{let{error:e}=await h.auth.signOut();if(e)throw e},b=(null==i?void 0:i.role)==="admin";return(0,s.jsx)(l.Provider,{value:{user:t,profile:i,loading:d,signUp:g,signIn:x,signInWithGoogle:f,signOut:p,isAdmin:b},children:r})}function i(){let e=(0,a.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},6648:(e,r,t)=>{"use strict";t.d(r,{U:()=>a});var s=t(5417);function a(){return(0,s.createBrowserClient)("https://ejdwrepyuznanwujidai.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVqZHdyZXB5dXpuYW53dWppZGFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzNjk3NTYsImV4cCI6MjA4Mzk0NTc1Nn0.MRJe6csColzMRDpAWa-Ma99noAk6n8SbnXXHP2rNAJ4")}},9208:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>i});var s=t(5155),a=t(2619),o=t.n(a),l=t(5380),n=t(63);function i(e){var r,t;let{children:a}=e,{user:i,profile:c,signOut:d,loading:u}=(0,l.A)(),h=(0,n.useRouter)(),m=async()=>{try{await d(),h.push("/")}catch(e){console.error("Error signing out:",e)}};return u?(0,s.jsx)("div",{className:"min-h-screen bg-white flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:"Уншиж байна..."})]})}):(0,s.jsx)("div",{className:"min-h-screen bg-white",children:(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsxs)("aside",{className:"w-64 bg-gray-50 border-r border-gray-200 min-h-screen flex flex-col",children:[(0,s.jsx)("div",{className:"p-6",children:(0,s.jsx)(o(),{href:"/",className:"text-2xl font-semibold text-gray-900",children:"Admin Dashboard"})}),(0,s.jsxs)("nav",{className:"px-4 space-y-1 flex-1",children:[(0,s.jsx)(o(),{href:"/admin",className:"block px-4 py-3 text-base font-medium text-gray-700 hover:bg-gray-100 hover:text-gray-900 rounded-lg transition-colors",children:"Хянах самбар"}),(0,s.jsx)(o(),{href:"/admin/products",className:"block px-4 py-3 text-base font-medium text-gray-700 hover:bg-gray-100 hover:text-gray-900 rounded-lg transition-colors",children:"Бүтээгдэхүүн"}),(0,s.jsx)(o(),{href:"/admin/categories",className:"block px-4 py-3 text-base font-medium text-gray-700 hover:bg-gray-100 hover:text-gray-900 rounded-lg transition-colors",children:"Ангилал"}),(0,s.jsx)(o(),{href:"/admin/orders",className:"block px-4 py-3 text-base font-medium text-gray-700 hover:bg-gray-100 hover:text-gray-900 rounded-lg transition-colors",children:"Захиалга"}),(0,s.jsx)(o(),{href:"/admin/settings",className:"block px-4 py-3 text-base font-medium text-gray-700 hover:bg-gray-100 hover:text-gray-900 rounded-lg transition-colors",children:"Тохиргоо"}),(0,s.jsx)("div",{className:"border-t border-gray-200 my-4"}),(0,s.jsx)(o(),{href:"/admin/seed",className:"block px-4 py-3 text-base font-medium text-gray-700 hover:bg-gray-100 hover:text-gray-900 rounded-lg transition-colors",children:"Өгөгдөл нэмэх"})]}),(0,s.jsxs)("div",{className:"border-t border-gray-200 p-4",children:[i&&c&&(0,s.jsx)("div",{className:"mb-4 px-4 py-3 bg-white rounded-lg border border-gray-200",children:(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:" w-10 h-10 rounded-full bg-gray-900 flex items-center justify-center text-white font-medium",children:(null==(t=c.full_name)||null==(r=t[0])?void 0:r.toUpperCase())||"A"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:c.full_name||"Admin"}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"admin"===c.role?"Админ":"Хэрэглэгч"})]})]})}),(0,s.jsx)("button",{onClick:m,className:"w-full px-4 py-3 text-base text-red-600 hover:bg-red-50 rounded-lg transition-colors text-left",children:"Гарах"}),(0,s.jsx)(o(),{href:"/",className:"block px-4 py-3 text-base text-gray-600 hover:text-gray-900 rounded-lg transition-colors",children:"← Вэбсайт руу буцах"})]})]}),(0,s.jsx)("main",{className:"flex-1",children:a})]})})}}},e=>{e.O(0,[417,619,441,493,358],()=>e(e.s=3630)),_N_E=e.O()}]);