(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8733],{40601:(e,t,s)=>{"use strict";s.d(t,{default:()=>l});var a=s(95155),r=s(12115),i=s(65380);function l(){let{user:e}=(0,i.A)(),[t,s]=(0,r.useState)([]),[l,n]=(0,r.useState)(0),[d,o]=(0,r.useState)(!0),[c,m]=(0,r.useState)(null),[x,u]=(0,r.useState)(""),[h,p]=(0,r.useState)(""),[g,y]=(0,r.useState)(""),[f,b]=(0,r.useState)(0),N=async()=>{o(!0),u("");try{var e;let t=new URLSearchParams({limit:String(20),offset:String(20*f)});g.trim()&&t.set("q",g.trim());let a=await fetch("/api/admin/users?".concat(t)),r=await a.json();if(!a.ok)throw Error(r.error||"Алдаа");s(r.users||[]),n(null!=(e=r.total)?e:0)}catch(e){u(e instanceof Error?e.message:"Хэрэглэгч татахад алдаа гарлаа")}finally{o(!1)}};(0,r.useEffect)(()=>{N()},[f,g]);let j=async(e,t)=>{m(e),u(""),p("");try{let s=await fetch("/api/admin/users/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:t})}),a=await s.json();if(!s.ok)throw Error(a.error||"Алдаа");p("Эрх шинэчлэгдлээ: ".concat("admin"===t?"Админ":"Хэрэглэгч")),N()}catch(e){u(e instanceof Error?e.message:"Эрх шинэчлэхэд алдаа")}finally{m(null)}},v=e=>e?new Date(e).toLocaleDateString("mn-MN",{dateStyle:"short"}):"—";return(0,a.jsxs)("div",{className:"space-y-4 sm:space-y-6 max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"Хэрэглэгчийн удирдлага"}),(0,a.jsx)("p",{className:"text-sm sm:text-base text-gray-600 mt-1",children:"Бүртгэлтэй хэрэглэгчдийг харах, эрх өгөх/хасах"})]}),x&&(0,a.jsx)("div",{className:"p-3 sm:p-4 bg-red-50 border border-red-200 rounded-lg text-sm text-red-700",children:x}),h&&(0,a.jsx)("div",{className:"p-3 sm:p-4 bg-green-50 border border-green-200 rounded-lg text-sm text-green-700",children:h}),(0,a.jsx)("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:(0,a.jsx)("input",{type:"search",placeholder:"Нэр хайх...",value:g,onChange:e=>{y(e.target.value),b(0)},className:"flex-1 px-4 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-900 focus:border-transparent"})}),d?(0,a.jsx)("div",{className:"p-12 text-center text-gray-500",children:"Ачааллаж байна..."}):0===t.length?(0,a.jsx)("div",{className:"p-12 text-center text-gray-500",children:"Хэрэглэгч олдсонгүй"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"hidden lg:block bg-white border border-gray-200 rounded-lg overflow-hidden",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-left",children:[(0,a.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-sm font-medium text-gray-700",children:"Нэр"}),(0,a.jsx)("th",{className:"px-4 py-3 text-sm font-medium text-gray-700",children:"Имэйл"}),(0,a.jsx)("th",{className:"px-4 py-3 text-sm font-medium text-gray-700",children:"Утас"}),(0,a.jsx)("th",{className:"px-4 py-3 text-sm font-medium text-gray-700",children:"Эрх"}),(0,a.jsx)("th",{className:"px-4 py-3 text-sm font-medium text-gray-700",children:"Бүртгэсэн"}),(0,a.jsx)("th",{className:"px-4 py-3 text-sm font-medium text-gray-700",children:"Үйлдэл"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200",children:t.map(t=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsxs)("td",{className:"px-4 py-3",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:t.full_name||"—"}),t.promo_code&&(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["Promo: ",t.promo_code]})]}),(0,a.jsx)("td",{className:"px-4 py-3 text-gray-700 text-sm",children:t.email||"—"}),(0,a.jsx)("td",{className:"px-4 py-3 text-gray-700 text-sm",children:t.phone_number||"—"}),(0,a.jsxs)("td",{className:"px-4 py-3",children:[(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full ".concat("admin"===t.role?"bg-indigo-100 text-indigo-800":"bg-gray-100 text-gray-700"),children:"admin"===t.role?"Админ":"Хэрэглэгч"}),t.is_top6&&(0,a.jsx)("span",{className:"ml-1 inline-flex px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800",children:"Top 6"})]}),(0,a.jsx)("td",{className:"px-4 py-3 text-gray-600 text-sm",children:v(t.created_at)}),(0,a.jsx)("td",{className:"px-4 py-3",children:"admin"===t.role?(null==e?void 0:e.id)===t.id?(0,a.jsx)("span",{className:"text-gray-400 text-sm",children:"Та"}):(0,a.jsx)("button",{onClick:()=>j(t.id,"user"),disabled:!!c,className:"text-sm text-red-600 hover:underline disabled:opacity-50",children:c===t.id?"...":"Эрх хасах"}):(0,a.jsx)("button",{onClick:()=>j(t.id,"admin"),disabled:!!c,className:"text-sm text-indigo-600 hover:underline disabled:opacity-50",children:c===t.id?"...":"Админ болгох"})})]},t.id))})]})})}),(0,a.jsx)("div",{className:"lg:hidden space-y-3",children:t.map(t=>(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 truncate",children:t.full_name||"—"}),t.promo_code&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Promo: ",t.promo_code]})]}),(0,a.jsxs)("div",{className:"flex gap-1 ml-2",children:[(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full ".concat("admin"===t.role?"bg-indigo-100 text-indigo-800":"bg-gray-100 text-gray-700"),children:"admin"===t.role?"Админ":"Хэрэглэгч"}),t.is_top6&&(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800",children:"Top 6"})]})]}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-500",children:"Имэйл:"}),(0,a.jsx)("span",{className:"text-gray-900 truncate ml-2",children:t.email||"—"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-500",children:"Утас:"}),(0,a.jsx)("span",{className:"text-gray-900",children:t.phone_number||"—"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-500",children:"Бүртгэсэн:"}),(0,a.jsx)("span",{className:"text-gray-900",children:v(t.created_at)})]})]}),(0,a.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:"admin"===t.role?(null==e?void 0:e.id)===t.id?(0,a.jsx)("span",{className:"text-gray-400 text-sm",children:"Та"}):(0,a.jsx)("button",{onClick:()=>j(t.id,"user"),disabled:!!c,className:"w-full py-2 text-sm font-medium text-red-600 bg-red-50 rounded-lg hover:bg-red-100 disabled:opacity-50 transition-colors",children:c===t.id?"Уншиж байна...":"Эрх хасах"}):(0,a.jsx)("button",{onClick:()=>j(t.id,"admin"),disabled:!!c,className:"w-full py-2 text-sm font-medium text-indigo-600 bg-indigo-50 rounded-lg hover:bg-indigo-100 disabled:opacity-50 transition-colors",children:c===t.id?"Уншиж байна...":"Админ болгох"})})]},t.id))})]}),l>20&&(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3 px-4 py-3 bg-white border border-gray-200 rounded-lg",children:[(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["Нийт ",l," хэрэглэгч"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>b(e=>Math.max(0,e-1)),disabled:0===f,className:"px-4 py-2 text-sm font-medium border border-gray-300 rounded-lg disabled:opacity-50 hover:bg-gray-100 transition-colors",children:"Өмнөх"}),(0,a.jsx)("button",{onClick:()=>b(e=>e+1),disabled:(f+1)*20>=l,className:"px-4 py-2 text-sm font-medium border border-gray-300 rounded-lg disabled:opacity-50 hover:bg-gray-100 transition-colors",children:"Дараах"})]})]})]})}},52940:(e,t,s)=>{Promise.resolve().then(s.bind(s,40601))},65380:(e,t,s)=>{"use strict";s.d(t,{A:()=>d,AuthProvider:()=>n});var a=s(95155),r=s(12115),i=s(96648);let l=(0,r.createContext)(void 0);function n(e){let{children:t}=e,[s,n]=(0,r.useState)(null),[d,o]=(0,r.useState)(null),[c,m]=(0,r.useState)(!0),x=(0,i.U)();(0,r.useEffect)(()=>{x.auth.getSession().then(e=>{var t;let{data:{session:s}}=e;n(null!=(t=null==s?void 0:s.user)?t:null),(null==s?void 0:s.user)?u(s.user.id):m(!1)});let{data:{subscription:e}}=x.auth.onAuthStateChange((e,t)=>{var s;n(null!=(s=null==t?void 0:t.user)?s:null),(null==t?void 0:t.user)?u(t.user.id):(o(null),m(!1))});return()=>e.unsubscribe()},[]);let u=async e=>{try{let{data:t,error:s}=await x.from("profiles").select("*").eq("id",e).single();if(s)throw s;o(t)}catch(e){}finally{m(!1)}},h=async(e,t,s,a)=>{let r=t.replace(/[^0-9]/g,""),{data:i,error:l}=await x.auth.signUp({email:e,password:s,options:{data:{full_name:a||"",phone_number:r},emailRedirectTo:void 0}});if(l){if(l.message.includes("Signups not allowed"))throw Error('Бүртгэл идэвхгүй байна. Суpabase dashboard-аас "Enable email signups" асаах шаардлагатай. Authentication → Providers → Email → Enable email signups');throw l}i.user&&(n(i.user),await u(i.user.id))},p=async(e,t)=>{let s;if(e.includes("@"))s=e.trim();else{let t=e.replace(/[^0-9]/g,"");if(!t||t.length<8)throw Error("Утасны дугаар буруу байна");let{data:a,error:r}=await x.from("profiles").select("email").eq("phone_number",t).single();if(r)throw Error("Утасны дугаараар бүртгэл олдсонгүй. И-мэйл ашиглана уу.");if(!(null==a?void 0:a.email))throw Error("Бүртгэлийн мэдээлэл дутуу байна. Та дахин бүртгүүлнэ үү.");s=a.email}let{data:a,error:r}=await x.auth.signInWithPassword({email:s,password:t});if(r)throw r},g=async()=>{let{data:e,error:t}=await x.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});if(t)throw t},y=async()=>{let{error:e}=await x.auth.signOut();if(e)throw e},f=async()=>{s&&await u(s.id)},b=(null==d?void 0:d.role)==="admin";return(0,a.jsx)(l.Provider,{value:{user:s,profile:d,loading:c,signUp:h,signIn:p,signInWithGoogle:g,signOut:y,refreshProfile:f,isAdmin:b},children:t})}function d(){let e=(0,r.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},96648:(e,t,s)=>{"use strict";s.d(t,{U:()=>n});var a=s(55417);let r="https://ejdwrepyuznanwujidai.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVqZHdyZXB5dXpuYW53dWppZGFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzNjk3NTYsImV4cCI6MjA4Mzk0NTc1Nn0.MRJe6csColzMRDpAWa-Ma99noAk6n8SbnXXHP2rNAJ4",l=null;function n(){return function(){if(!r||r.includes("placeholder")||r.includes("MISSING"))throw Error("❌ Supabase configuration missing!\n\nNEXT_PUBLIC_SUPABASE_URL is not set.\n\nTo fix this:\n1. Go to Cloudflare Dashboard → Workers & Pages → Your Project\n2. Settings → Environment variables\n3. Add NEXT_PUBLIC_SUPABASE_URL with your Supabase project URL\n\nSee DEPLOYMENT.md for detailed instructions.");if(!i||i.includes("placeholder")||i.includes("MISSING"))throw Error("❌ Supabase configuration missing!\n\nNEXT_PUBLIC_SUPABASE_ANON_KEY is not set.\n\nTo fix this:\n1. Go to Cloudflare Dashboard → Workers & Pages → Your Project\n2. Settings → Environment variables\n3. Add NEXT_PUBLIC_SUPABASE_ANON_KEY with your Supabase anon key\n\nSee DEPLOYMENT.md for detailed instructions.")}(),l||(l=(0,a.createBrowserClient)(r,i)),l}}},e=>{e.O(0,[1500,5417,8441,1255,7358],()=>e(e.s=52940)),_N_E=e.O()}]);