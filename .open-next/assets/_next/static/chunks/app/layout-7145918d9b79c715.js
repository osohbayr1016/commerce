(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7177],{2503:(t,e,r)=>{"use strict";r.d(e,{CartProvider:()=>f,_:()=>y});var i=r(5155),a=r(2115),n=r(5380);async function o(t){try{for(let e of t)await c(e.id,e.quantity,e.size)}catch(t){}}async function s(){try{let t=await fetch("/api/cart");if(!t.ok)return[];return(await t.json()).items||[]}catch(t){return[]}}async function c(t,e,r){try{return(await fetch("/api/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:t,quantity:e,size:r||null})})).ok}catch(t){return!1}}async function l(t,e,r){try{return(await fetch("/api/cart",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:t,quantity:e,size:r||null})})).ok}catch(t){return!1}}async function u(t,e){try{let r=new URL("/api/cart",window.location.origin);return r.searchParams.set("product_id",t),e&&r.searchParams.set("size",e.toString()),(await fetch(r.toString(),{method:"DELETE"})).ok}catch(t){return!1}}let d=(0,a.createContext)(void 0);function f(t){let{children:e}=t,{user:r}=(0,n.A)(),[f,y]=(0,a.useState)([]),[h,m]=(0,a.useState)(!1),p=(0,a.useRef)(null),w=(0,a.useRef)(!0),k=r?"cart:".concat(r.id):null;(0,a.useEffect)(()=>{if(!r||!k)return void y([]);(async()=>{m(!0);try{let t=await s(),e=localStorage.getItem(k),r=e?JSON.parse(e):[],i=[...t];r.forEach(t=>{i.find(e=>e.id===t.id&&e.size===t.size)||i.push(t)}),y(i),localStorage.setItem(k,JSON.stringify(i)),r.length>0&&t.length!==i.length&&await o(i)}catch(e){let t=localStorage.getItem(k);y(t?JSON.parse(t):[])}finally{m(!1),w.current=!1}})()},[r,k]),(0,a.useEffect)(()=>{k&&!w.current&&localStorage.setItem(k,JSON.stringify(f))},[f,k]),(0,a.useEffect)(()=>{if(r&&k&&!w.current)return p.current&&clearTimeout(p.current),p.current=setTimeout(async()=>{m(!0);try{for(let t of f)await c(t.id,t.quantity,t.size)}catch(t){}finally{m(!1)}},1e3),()=>{p.current&&clearTimeout(p.current)}},[f,r,k]);let z=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!r)return{ok:!1};try{let r=await fetch("/api/products/".concat(t.id,"/stock"));if(r.ok){var i;let a=await r.json(),n=((null==(i=f.find(e=>e.id===t.id&&e.size===t.size))?void 0:i.quantity)||0)+e;if(a.stock<n)return{ok:!1,error:0===a.stock?"Бэлэн бараа байхгүй":"Зөвхөн ".concat(a.stock," ширхэг үлдсэн")}}}catch(t){}y(r=>r.find(e=>e.id===t.id&&e.size===t.size)?r.map(r=>r.id===t.id&&r.size===t.size?{...r,quantity:r.quantity+e}:r):[...r,{...t,quantity:e}]);try{await c(t.id,e,t.size)}catch(t){}return{ok:!0}},b=async(t,e)=>{let r=Math.max(1,e),i=f.find(e=>e.id===t);try{let e=await fetch("/api/products/".concat(t,"/stock"));if(e.ok){let a=await e.json();if(a.stock<r){let e=Math.min(a.stock,r);y(r=>r.map(r=>r.id===t?{...r,quantity:e}:r)),i&&await l(t,e,i.size);return}}}catch(t){}if(y(e=>e.map(e=>e.id===t?{...e,quantity:r}:e)),i)try{await l(t,r,i.size)}catch(t){}},v=async t=>{let e=f.find(e=>e.id===t);if(y(e=>e.filter(e=>e.id!==t)),e)try{await u(t,e.size)}catch(t){}},_=async()=>{if(r)try{for(let t of f)await u(t.id,t.size)}catch(t){}y([])},N=(0,a.useMemo)(()=>f.reduce((t,e)=>t+e.price*e.quantity,0),[f]),S=(0,a.useMemo)(()=>f.reduce((t,e)=>t+e.quantity,0),[f]);return(0,i.jsx)(d.Provider,{value:{items:f,subtotal:N,totalItems:S,addItem:z,updateQuantity:b,removeItem:v,clearCart:_,syncing:h},children:e})}function y(){let t=(0,a.useContext)(d);if(!t)throw Error("useCart must be used within a CartProvider");return t}},3673:()=>{},4635:t=>{t.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_188709",variable:"__variable_188709"}},6648:(t,e,r)=>{"use strict";r.d(e,{U:()=>a});var i=r(5417);function a(){return(0,i.createBrowserClient)("https://ejdwrepyuznanwujidai.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVqZHdyZXB5dXpuYW53dWppZGFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzNjk3NTYsImV4cCI6MjA4Mzk0NTc1Nn0.MRJe6csColzMRDpAWa-Ma99noAk6n8SbnXXHP2rNAJ4")}},8564:(t,e,r)=>{Promise.resolve().then(r.t.bind(r,2619,23)),Promise.resolve().then(r.t.bind(r,4635,23)),Promise.resolve().then(r.t.bind(r,8615,23)),Promise.resolve().then(r.t.bind(r,3673,23)),Promise.resolve().then(r.bind(r,6905)),Promise.resolve().then(r.bind(r,5380)),Promise.resolve().then(r.bind(r,2503)),Promise.resolve().then(r.bind(r,2435)),Promise.resolve().then(r.bind(r,8747))},8615:t=>{t.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_9a8899",variable:"__variable_9a8899"}}},t=>{t.O(0,[4614,5417,2619,5928,3487,8441,1255,7358],()=>t(t.s=8564)),_N_E=t.O()}]);