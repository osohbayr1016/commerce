(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8279],{1935:(e,t,r)=>{"use strict";r.d(t,{default:()=>i});var s=r(95155),a=r(20063),l=r(18747);function i(e){let{href:t,className:r=""}=e,i=(0,a.useRouter)(),{t:n}=(0,l.o)();return(0,s.jsxs)("button",{onClick:()=>{t?i.push(t):window.history.length>1?i.back():i.push("/")},className:"inline-flex items-center gap-2 text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors ".concat(r),children:[(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),n("common.back")||"Back"]})}},4036:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>b});var s=r(95155),a=r(12115),l=r(20063),i=r(26424),n=r(5042),o=r(65380),c=r(52503);function d(e){let{items:t,defaultValues:r,onSuccess:l}=e,{profile:i}=(0,o.A)(),[n,c]=(0,a.useState)("info"),[d,x]=(0,a.useState)(r),[m,u]=(0,a.useState)("bank"),[h,g]=(0,a.useState)(!1),[f,y]=(0,a.useState)(""),p=t.reduce((e,t)=>e+t.price*t.quantity,0),b=Math.ceil(p/1e3),j=(null==i?void 0:i.coin_balance)||0,v=j>=b;(0,a.useEffect)(()=>{x(e=>({...e,...r}))},[r]);let N=e=>{let{name:t,value:r}=e.target;x(e=>({...e,[t]:r}))},w=async e=>{if(e.preventDefault(),0!==t.length){if("coins"===m&&!v)return void y("Хангалтгүй монет. Таны үлдэгдэл: ".concat(j,", Шаардлагатай: ").concat(b));g(!0),y("");try{let e=await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:t,customer:d,paymentMethod:m,coinPayment:"coins"===m?{coinsUsed:b,totalInMNT:p}:void 0})});if(!e.ok){let t=await e.json();throw Error(t.error||"Захиалга үүсгэхэд алдаа гарлаа")}l()}catch(e){y(e.message||"Захиалга үүсгэхэд алдаа гарлаа")}finally{g(!1)}}};return(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200",children:[(0,s.jsxs)("div",{className:"flex border-b border-gray-200",children:[(0,s.jsx)("button",{type:"button",onClick:()=>c("info"),className:"flex-1 px-6 py-4 text-center font-medium transition-colors ".concat("info"===n?"text-gray-900 border-b-2 border-gray-900":"text-gray-500 hover:text-gray-700"),children:"Мэдээлэл"}),(0,s.jsx)("button",{type:"button",onClick:()=>c("payment"),className:"flex-1 px-6 py-4 text-center font-medium transition-colors ".concat("payment"===n?"text-gray-900 border-b-2 border-gray-900":"text-gray-500 hover:text-gray-700"),children:"Төлбөр төлөх"})]}),(0,s.jsx)("div",{className:"p-6",children:"info"===n?(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),c("payment")},className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Нэр ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{name:"fullName",value:d.fullName,onChange:N,placeholder:"Зочин#HG01",className:"w-full rounded-lg border border-gray-300 px-4 py-3 text-gray-900 focus:border-gray-900 focus:ring-1 focus:ring-gray-900",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Утас ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{name:"phone",value:d.phone,onChange:N,placeholder:"Утас *",className:"w-full rounded-lg border border-gray-300 px-4 py-3 text-gray-900 focus:border-gray-900 focus:ring-1 focus:ring-gray-900",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Нэмэлт мэдээлэл"}),(0,s.jsx)("textarea",{name:"note",value:d.note,onChange:N,placeholder:"Нэмэлт мэдээлэл",className:"w-full rounded-lg border border-gray-300 px-4 py-3 text-gray-900 focus:border-gray-900 focus:ring-1 focus:ring-gray-900",rows:4})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"what3words хаяг"}),(0,s.jsx)("input",{name:"address",value:d.address,onChange:N,placeholder:"///далай.бармат.юкинсэх т.м",className:"w-full rounded-lg border border-gray-300 px-4 py-3 text-gray-900 focus:border-gray-900 focus:ring-1 focus:ring-gray-900",required:!0})]}),(0,s.jsx)("button",{type:"submit",className:"w-full rounded-lg bg-black px-6 py-3 text-white font-medium hover:bg-gray-800 transition-colors",children:"Үргэлжлүүлэх"})]}):(0,s.jsxs)("form",{onSubmit:w,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{onClick:()=>u("qpay"),className:"flex items-center gap-4 p-4 rounded-lg border-2 cursor-pointer transition-all ".concat("qpay"===m?"border-gray-900 bg-gray-50":"border-gray-200 hover:border-gray-300"),children:[(0,s.jsx)("div",{className:"flex items-center justify-center w-12 h-12 rounded-lg bg-blue-900",children:(0,s.jsx)("span",{className:"text-white font-bold text-xl",children:"Q"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"font-medium text-gray-900",children:"QPay"}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Төлбөрөө QPay хэтэвчээр ашиглан төлөх сонголт"})]}),(0,s.jsx)("div",{className:"w-5 h-5 rounded-full border-2 flex items-center justify-center ".concat("qpay"===m?"border-gray-900 bg-gray-900":"border-gray-300"),children:"qpay"===m&&(0,s.jsx)("div",{className:"w-2 h-2 rounded-full bg-white"})})]}),(0,s.jsxs)("div",{onClick:()=>u("bank"),className:"flex items-center gap-4 p-4 rounded-lg border-2 cursor-pointer transition-all ".concat("bank"===m?"border-gray-900 bg-gray-50":"border-gray-200 hover:border-gray-300"),children:[(0,s.jsx)("div",{className:"flex items-center justify-center w-12 h-12 rounded-lg bg-blue-500",children:(0,s.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"font-medium text-gray-900",children:"Дансаар шилжүүлэх"}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Дансаар шинэтгэл шилжүүлэг хийх"})]}),(0,s.jsx)("div",{className:"w-5 h-5 rounded-full border-2 flex items-center justify-center ".concat("bank"===m?"border-gray-900 bg-gray-900":"border-gray-300"),children:"bank"===m&&(0,s.jsx)("div",{className:"w-2 h-2 rounded-full bg-white"})})]}),(0,s.jsxs)("div",{onClick:()=>v&&u("coins"),className:"flex items-center gap-4 p-4 rounded-lg border-2 transition-all ".concat(!v?"opacity-50 cursor-not-allowed":"cursor-pointer"," ").concat("coins"===m?"border-yellow-500 bg-yellow-50":"border-gray-200 hover:border-gray-300"),children:[(0,s.jsx)("div",{className:"flex items-center justify-center w-12 h-12 rounded-lg bg-yellow-500",children:(0,s.jsx)("svg",{className:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.31-8.86c-1.77-.45-2.34-.94-2.34-1.67 0-.84.79-1.43 2.1-1.43 1.38 0 1.9.66 1.94 1.64h1.71c-.05-1.34-.87-2.57-2.49-2.97V5H10.9v1.69c-1.51.32-2.72 1.3-2.72 2.81 0 1.79 1.49 2.69 3.66 3.21 1.95.46 2.34 1.15 2.34 1.87 0 .53-.39 1.39-2.1 1.39-1.6 0-2.23-.72-2.32-1.64H8.04c.1 1.7 1.36 2.66 2.86 2.97V19h2.34v-1.67c1.52-.29 2.72-1.16 2.73-2.77-.01-2.2-1.9-2.96-3.66-3.42z"})})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"font-medium text-gray-900",children:"Монетоор төлөх"}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:v?(0,s.jsxs)(s.Fragment,{children:["Шаардлагатай: ",b," монет (Үлдэгдэл: ",j,")"]}):(0,s.jsxs)("span",{className:"text-red-500",children:["Хангалтгүй монет (Шаардлагатай: ",b,", Үлдэгдэл: ",j,")"]})})]}),(0,s.jsx)("div",{className:"w-5 h-5 rounded-full border-2 flex items-center justify-center ".concat("coins"===m?"border-yellow-500 bg-yellow-500":"border-gray-300"),children:"coins"===m&&(0,s.jsx)("div",{className:"w-2 h-2 rounded-full bg-white"})})]})]}),f&&(0,s.jsx)("p",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:f}),(0,s.jsx)("button",{type:"submit",disabled:h,className:"w-full rounded-lg bg-black px-6 py-3 text-white font-medium hover:bg-gray-800 transition-colors disabled:opacity-60 disabled:cursor-not-allowed",children:h?"Илгээж байна...":"Төлбөр төлөх"})]})})]})}var x=r(15239),m=r(64269);function u(e){let{items:t,subtotal:r,discount:l=0,total:i}=e,[n,o]=(0,a.useState)(t);return(0,a.useEffect)(()=>{(async()=>{o(await Promise.all(t.map(async e=>{let t=null;if(e.images&&Array.isArray(e.images)&&e.images.length>0){let r=e.images[0];r&&"string"==typeof r&&r.trim()&&!r.match(/^image\d+$/)&&(t=r.trim())}if(!t&&e.id)try{let r=await fetch("/api/products/".concat(e.id));if(r.ok){let e=await r.json();if((null==e?void 0:e.images)&&Array.isArray(e.images)&&e.images.length>0){let r=e.images[0];r&&"string"==typeof r&&r.trim()&&!r.match(/^image\d+$/)&&(t=r.trim())}}}catch(e){}return{...e,imageUrl:t}})))})()},[t]),(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6 h-fit sticky top-4",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Миний сагс"}),(0,s.jsx)("div",{className:"space-y-4 mb-6",children:n.map(e=>(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)("div",{className:"w-20 h-20 relative overflow-hidden rounded-lg border border-gray-200",children:e.imageUrl?(0,s.jsx)(x.default,{src:e.imageUrl,alt:e.name,fill:!0,sizes:"80px",className:"object-cover",loading:"lazy"}):(0,s.jsx)("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center",style:{backgroundColor:e.imageColor||"#FAFAFA"},children:(0,s.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-900 line-clamp-2 mb-1",children:e.name}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("span",{className:"text-sm text-gray-500",children:["Тоо ширхэг: ",e.quantity]}),(0,s.jsxs)("span",{className:"text-sm font-semibold text-gray-900",children:[(0,m.$)(e.price*e.quantity)," ₮"]})]})]})]},e.id))}),(0,s.jsxs)("div",{className:"space-y-3 border-t border-gray-200 pt-4",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Нагш үнэ"}),(0,s.jsxs)("span",{className:"text-gray-900",children:[(0,m.$)(r)," ₮"]})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Хөнгөлөлт"}),(0,s.jsx)("span",{className:"text-gray-900",children:"0 ₮"})]}),(0,s.jsxs)("div",{className:"flex justify-between pt-3 border-t border-gray-200",children:[(0,s.jsx)("span",{className:"font-semibold text-gray-900",children:"Нийт үнэ"}),(0,s.jsxs)("span",{className:"text-xl font-bold text-gray-900",children:[(0,m.$)(r)," ₮"]})]})]})]})}var h=r(66905);function g(e){let{orderAmount:t,onApply:r}=e,{user:l}=(0,o.A)(),{showToast:i}=(0,h.d)(),[n,c]=(0,a.useState)(""),[d,x]=(0,a.useState)(!1),[m,u]=(0,a.useState)(!1),[g,f]=(0,a.useState)(0),y=async()=>{if(!n.trim())return void i("Please enter a promo code","error");x(!0);try{let e=await fetch("/api/promo/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:n.toUpperCase(),userId:null==l?void 0:l.id,orderAmount:t})}),s=await e.json();if(!e.ok)return void i(s.error||"Invalid promo code","error");f(s.discountAmount),u(!0),r(s.discountAmount,s.promoCodeId),i(s.message||"Promo code applied!","success")}catch(e){i("Failed to apply promo code","error")}finally{x(!1)}};return(0,s.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),(0,s.jsx)("h3",{className:"font-medium text-gray-900",children:"Promo Code"})]}),m?(0,s.jsxs)("div",{className:"flex items-center justify-between bg-green-50 border border-green-200 rounded-lg p-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-green-900",children:n}),(0,s.jsxs)("p",{className:"text-xs text-green-700",children:["-",new Intl.NumberFormat("mn-MN").format(g)," ₮ discount"]})]})]}),(0,s.jsx)("button",{onClick:()=>{c(""),u(!1),f(0),r(0,""),i("Promo code removed","info")},className:"text-sm text-red-600 hover:text-red-700 font-medium",children:"Remove"})]}):(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{type:"text",value:n,onChange:e=>c(e.target.value.toUpperCase()),placeholder:"Enter code",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 text-sm",disabled:d}),(0,s.jsx)("button",{onClick:y,disabled:d||!n.trim(),className:"px-4 py-2 bg-gray-900 text-white rounded-lg text-sm font-medium hover:bg-gray-800 disabled:bg-gray-300 disabled:cursor-not-allowed transition",children:d?"...":"Apply"})]}),(0,s.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:[(0,s.jsx)("p",{children:"• Promo codes cannot be combined"}),(0,s.jsx)("p",{children:"• Some codes have minimum purchase requirements"})]})]})}function f(e){var t;let{subtotal:r,onDiscountChange:l}=e,{profile:i}=(0,o.A)(),[n,c]=(0,a.useState)(null),[d,x]=(0,a.useState)(!0),[m,u]=(0,a.useState)(0);(0,a.useEffect)(()=>{h()},[]);let h=async()=>{try{let e=await fetch("/api/referral/stats");if(e.ok){let t=await e.json();c(t.stats)}}catch(e){console.error("Failed to fetch stats:",e)}finally{x(!1)}},g=e=>{u(e),l(e)};if(d)return(0,s.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Уншиж байна..."})});if(!n||!i)return null;let f=i.accumulated_discount_percent||0,y=n.can_use_discount,p=Math.floor(r*f/100);return 0===f?null:(0,s.jsxs)("div",{className:" from-yellow-50 to-amber-50 border border-yellow-200 rounded-lg p-5",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,s.jsx)("span",{className:"text-2xl",children:"\uD83C\uDF81"}),(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:"Referral Discount"})]}),y?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg p-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Боломжтой discount:"}),(0,s.jsxs)("span",{className:"text-lg font-bold text-green-600",children:[f,"%"]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("label",{className:"flex items-center gap-3 cursor-pointer",children:[(0,s.jsx)("input",{type:"radio",name:"discount",checked:0===m,onChange:()=>g(0),className:"w-4 h-4"}),(0,s.jsx)("span",{className:"text-sm text-gray-700",children:"Discount ашиглахгүй"})]}),(0,s.jsxs)("label",{className:"flex items-center gap-3 cursor-pointer",children:[(0,s.jsx)("input",{type:"radio",name:"discount",checked:m===f,onChange:()=>g(f),className:"w-4 h-4"}),(0,s.jsxs)("span",{className:"text-sm text-gray-700",children:["Бүх discount ашиглах (",f,"%)"]})]})]})]}),m>0&&(0,s.jsxs)("div",{className:"bg-green-100 border border-green-300 rounded-lg p-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-green-900",children:"Хямдрал:"}),(0,s.jsxs)("span",{className:"text-lg font-bold text-green-600",children:["-₮",p.toLocaleString()]})]}),(0,s.jsxs)("p",{className:"text-xs text-green-700 mt-1",children:[m,"% discount ашигласан"]})]}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"\uD83D\uDCA1 Та энэ discount-г зөвхөн нэг удаа ашиглах боломжтой"})]}):(0,s.jsxs)("div",{className:"bg-white border border-yellow-300 rounded-lg p-4",children:[(0,s.jsxs)("p",{className:"text-sm text-gray-700 mb-2",children:["Та ",(0,s.jsxs)("span",{className:"font-bold",children:[f,"%"]})," discount цуглуулсан байна!"]}),(0,s.jsx)("p",{className:"text-xs text-red-600",children:"Discount ашиглахын тулд сүүлийн 30 хоногт 30 сая төгрөгийн худалдан авалт хийх шаардлагатай."}),(0,s.jsxs)("p",{className:"text-xs text-gray-600 mt-2",children:["Одоогийн үлдэгдэл: ₮",null==(t=n.purchases_30d)?void 0:t.toLocaleString()," / ₮ 30,000,000"]})]})]})}var y=r(1935);let p={fullName:"",phone:"",email:"",address:"",note:""};function b(){let{user:e,profile:t,loading:r}=(0,o.A)(),{items:x,subtotal:m,clearCart:h}=(0,c._)(),b=(0,l.useRouter)(),[j,v]=(0,a.useState)(0),[N,w]=(0,a.useState)(""),[k,C]=(0,a.useState)(0),S=(0,a.useMemo)(()=>({...p,fullName:(null==t?void 0:t.full_name)||"",phone:(null==t?void 0:t.phone_number)||"",email:(null==e?void 0:e.email)||""}),[t,e]),z=Math.floor(m*k/100),M=m-j-z;return((0,a.useEffect)(()=>{r||e||b.push("/auth/login?redirect=/checkout")},[r,e,b]),r)?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-white",children:(0,s.jsx)("p",{className:"text-gray-600",children:"Уншиж байна..."})}):(0,s.jsxs)("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[(0,s.jsx)(i.A,{}),(0,s.jsx)("main",{className:"flex-1 py-8 md:py-12",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)(y.default,{})}),0===x.length?(0,s.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-8 text-center",children:(0,s.jsx)("p",{className:"text-gray-600",children:"Сагс хоосон байна"})}):(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsx)("div",{className:"lg:col-span-2 order-2 lg:order-1",children:(0,s.jsx)(d,{items:x,defaultValues:S,onSuccess:()=>{h(),b.push("/profile?tab=orders")}})}),(0,s.jsxs)("div",{className:"lg:col-span-1 order-1 lg:order-2 space-y-4",children:[(0,s.jsx)(g,{orderAmount:m,onApply:(e,t)=>{v(e),w(t)}}),(0,s.jsx)(f,{subtotal:m,onDiscountChange:e=>C(e)}),(0,s.jsx)(u,{items:x,subtotal:m,discount:j+z,total:M})]})]})]})}),(0,s.jsx)(n.A,{})]})}},5042:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var s=r(95155);function a(){return(0,s.jsx)("footer",{className:"bg-white border-t border-gray-200 mt-12",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 md:gap-10",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg md:text-xl font-semibold text-gray-900 mb-5",children:"E-Commerce"}),(0,s.jsx)("p",{className:"text-gray-600 text-sm md:text-base leading-relaxed",children:"Онлайн худалдааг хөгжүүлэгч платформ"}),(0,s.jsxs)("div",{className:"mt-6 flex items-center gap-4 text-gray-500",children:[(0,s.jsx)("a",{href:"#",className:"hover:text-gray-900","aria-label":"facebook",children:(0,s.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})})}),(0,s.jsx)("a",{href:"#",className:"hover:text-gray-900","aria-label":"instagram",children:(0,s.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"})})}),(0,s.jsx)("a",{href:"#",className:"hover:text-gray-900","aria-label":"twitter",children:(0,s.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M23.954 4.569c-.885.392-1.83.656-2.825.775 1.014-.608 1.794-1.574 2.163-2.724-.949.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-2.723 0-4.93 2.207-4.93 4.93 0 .39.045.765.127 1.124-4.094-.205-7.725-2.165-10.158-5.144-.424.722-.666 1.561-.666 2.475 0 1.708.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.6 3.419-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 14-7.496 14-13.986 0-.209 0-.42-.016-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z"})})}),(0,s.jsx)("a",{href:"#",className:"hover:text-gray-900","aria-label":"youtube",children:(0,s.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg md:text-xl font-semibold text-gray-900 mb-5",children:"Туслах цэс"}),(0,s.jsxs)("ul",{className:"space-y-3",children:[(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:"#",className:"text-gray-700 hover:text-gray-900 text-base",children:"Бидний тухай"})}),(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:"#",className:"text-gray-700 hover:text-gray-900 text-base",children:"Холбоо барих"})}),(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:"#",className:"text-gray-700 hover:text-gray-900 text-base",children:"Түгээмэл асуултууд"})}),(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:"#",className:"text-gray-700 hover:text-gray-900 text-base",children:"Нийтлэл"})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg md:text-xl font-semibold text-gray-900 mb-4",children:"Холбоо барих"}),(0,s.jsx)("p",{className:"text-base text-gray-700 mb-4 leading-relaxed",children:"Somewhere"}),(0,s.jsx)("a",{href:"tel:99119911",className:"text-gray-700 hover:text-gray-900 block mb-2 text-base",children:"Утас: 99119911"}),(0,s.jsx)("a",{href:"mailto:test@gmail.com",className:"text-gray-700 hover:text-gray-900 block text-base",children:"И-мэйл: test@gmail.com"})]})]}),(0,s.jsxs)("div",{className:"mt-10 border-t border-gray-200 pt-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4 text-sm text-gray-500",children:[(0,s.jsx)("p",{children:"Developed by Twissu"}),(0,s.jsxs)("div",{className:"flex items-center gap-4 text-gray-500",children:[(0,s.jsx)("a",{href:"/",className:"hover:text-gray-900",children:"Нүүр"}),(0,s.jsx)("a",{href:"#",className:"hover:text-gray-900",children:"Ангилал"}),(0,s.jsx)("a",{href:"#",className:"hover:text-gray-900",children:"Хямдрал"}),(0,s.jsx)("a",{href:"/profile",className:"hover:text-gray-900",children:"Профайл"})]})]})]})})}},19562:(e,t,r)=>{Promise.resolve().then(r.bind(r,4036))},26424:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var s=r(95155),a=r(32025);function l(){return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"sm:hidden fixed bottom-20 right-4 z-40",children:(0,s.jsx)(a.default,{})})})}},52503:(e,t,r)=>{"use strict";r.d(t,{CartProvider:()=>m,_:()=>u});var s=r(95155),a=r(12115),l=r(65380);async function i(e){try{for(let t of e)await o(t.id,t.quantity,t.size)}catch(e){}}async function n(){try{let e=await fetch("/api/cart");if(!e.ok)return[];return(await e.json()).items||[]}catch(e){return[]}}async function o(e,t,r){try{return(await fetch("/api/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:e,quantity:t,size:r||null})})).ok}catch(e){return!1}}async function c(e,t,r){try{return(await fetch("/api/cart",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:e,quantity:t,size:r||null})})).ok}catch(e){return!1}}async function d(e,t){try{let r=new URL("/api/cart",window.location.origin);return r.searchParams.set("product_id",e),t&&r.searchParams.set("size",t.toString()),(await fetch(r.toString(),{method:"DELETE"})).ok}catch(e){return!1}}let x=(0,a.createContext)(void 0);function m(e){let{children:t}=e,{user:r}=(0,l.A)(),[m,u]=(0,a.useState)([]),[h,g]=(0,a.useState)(!1),f=(0,a.useRef)(null),y=(0,a.useRef)(!0),p=r?"cart:".concat(r.id):null;(0,a.useEffect)(()=>{if(!r||!p)return void u([]);(async()=>{g(!0);try{let e=await n(),t=localStorage.getItem(p),r=t?JSON.parse(t):[],s=[...e];r.forEach(e=>{s.find(t=>t.id===e.id&&t.size===e.size)||s.push(e)}),u(s),localStorage.setItem(p,JSON.stringify(s)),r.length>0&&e.length!==s.length&&await i(s)}catch(t){let e=localStorage.getItem(p);u(e?JSON.parse(e):[])}finally{g(!1),y.current=!1}})()},[r,p]),(0,a.useEffect)(()=>{p&&!y.current&&localStorage.setItem(p,JSON.stringify(m))},[m,p]),(0,a.useEffect)(()=>{if(r&&p&&!y.current)return f.current&&clearTimeout(f.current),f.current=setTimeout(async()=>{g(!0);try{for(let e of m)await o(e.id,e.quantity,e.size)}catch(e){}finally{g(!1)}},1e3),()=>{f.current&&clearTimeout(f.current)}},[m,r,p]);let b=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!r)return{ok:!1};try{let r=await fetch("/api/products/".concat(e.id,"/stock"));if(r.ok){var s;let a=await r.json(),l=((null==(s=m.find(t=>t.id===e.id&&t.size===e.size))?void 0:s.quantity)||0)+t;if(a.stock<l)return{ok:!1,error:0===a.stock?"Бэлэн бараа байхгүй":"Зөвхөн ".concat(a.stock," ширхэг үлдсэн")}}}catch(e){}u(r=>r.find(t=>t.id===e.id&&t.size===e.size)?r.map(r=>r.id===e.id&&r.size===e.size?{...r,quantity:r.quantity+t}:r):[...r,{...e,quantity:t}]);try{await o(e.id,t,e.size)}catch(e){}return{ok:!0}},j=async(e,t)=>{let r=Math.max(1,t),s=m.find(t=>t.id===e);try{let t=await fetch("/api/products/".concat(e,"/stock"));if(t.ok){let a=await t.json();if(a.stock<r){let t=Math.min(a.stock,r);u(r=>r.map(r=>r.id===e?{...r,quantity:t}:r)),s&&await c(e,t,s.size);return}}}catch(e){}if(u(t=>t.map(t=>t.id===e?{...t,quantity:r}:t)),s)try{await c(e,r,s.size)}catch(e){}},v=async e=>{let t=m.find(t=>t.id===e);if(u(t=>t.filter(t=>t.id!==e)),t)try{await d(e,t.size)}catch(e){}},N=async()=>{if(r)try{for(let e of m)await d(e.id,e.size)}catch(e){}u([])},w=(0,a.useMemo)(()=>m.reduce((e,t)=>e+t.price*t.quantity,0),[m]),k=(0,a.useMemo)(()=>m.reduce((e,t)=>e+t.quantity,0),[m]);return(0,s.jsx)(x.Provider,{value:{items:m,subtotal:w,totalItems:k,addItem:b,updateQuantity:j,removeItem:v,clearCart:N,syncing:h},children:t})}function u(){let e=(0,a.useContext)(x);if(!e)throw Error("useCart must be used within a CartProvider");return e}},65380:(e,t,r)=>{"use strict";r.d(t,{A:()=>o,AuthProvider:()=>n});var s=r(95155),a=r(12115),l=r(96648);let i=(0,a.createContext)(void 0);function n(e){let{children:t}=e,[r,n]=(0,a.useState)(null),[o,c]=(0,a.useState)(null),[d,x]=(0,a.useState)(!0),m=(0,l.U)();(0,a.useEffect)(()=>{m.auth.getSession().then(e=>{var t;let{data:{session:r}}=e;n(null!=(t=null==r?void 0:r.user)?t:null),(null==r?void 0:r.user)?u(r.user.id):x(!1)});let{data:{subscription:e}}=m.auth.onAuthStateChange((e,t)=>{var r;n(null!=(r=null==t?void 0:t.user)?r:null),(null==t?void 0:t.user)?u(t.user.id):(c(null),x(!1))});return()=>e.unsubscribe()},[]);let u=async e=>{try{let{data:t,error:r}=await m.from("profiles").select("*").eq("id",e).single();if(r)throw r;c(t)}catch(e){}finally{x(!1)}},h=async(e,t,r,s)=>{let a=t.replace(/[^0-9]/g,""),{data:l,error:i}=await m.auth.signUp({email:e,password:r,options:{data:{full_name:s||"",phone_number:a},emailRedirectTo:void 0}});if(i){if(i.message.includes("Signups not allowed"))throw Error('Бүртгэл идэвхгүй байна. Суpabase dashboard-аас "Enable email signups" асаах шаардлагатай. Authentication → Providers → Email → Enable email signups');throw i}l.user&&(n(l.user),await u(l.user.id))},g=async(e,t)=>{let r;if(e.includes("@"))r=e.trim();else{let t=e.replace(/[^0-9]/g,"");if(!t||t.length<8)throw Error("Утасны дугаар буруу байна");let{data:s,error:a}=await m.from("profiles").select("email").eq("phone_number",t).single();if(a)throw Error("Утасны дугаараар бүртгэл олдсонгүй. И-мэйл ашиглана уу.");if(!(null==s?void 0:s.email))throw Error("Бүртгэлийн мэдээлэл дутуу байна. Та дахин бүртгүүлнэ үү.");r=s.email}let{data:s,error:a}=await m.auth.signInWithPassword({email:r,password:t});if(a)throw a},f=async()=>{let{data:e,error:t}=await m.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});if(t)throw t},y=async()=>{let{error:e}=await m.auth.signOut();if(e)throw e},p=async()=>{r&&await u(r.id)},b=(null==o?void 0:o.role)==="admin";return(0,s.jsx)(i.Provider,{value:{user:r,profile:o,loading:d,signUp:h,signIn:g,signInWithGoogle:f,signOut:y,refreshProfile:p,isAdmin:b},children:t})}function o(){let e=(0,a.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},66905:(e,t,r)=>{"use strict";r.d(t,{ToastProvider:()=>c,d:()=>d});var s=r(95155),a=r(88661),l=r.n(a),i=r(12115);function n(e){let{toast:t,onClose:r}=e;(0,i.useEffect)(()=>{let e=setTimeout(()=>{r(t.id)},t.duration||3e3);return()=>clearTimeout(e)},[t.id,t.duration,r]);let a="success"===t.type?"bg-green-50 border-green-200 text-green-800":"error"===t.type?"bg-red-50 border-red-200 text-red-800":"bg-blue-50 border-blue-200 text-blue-800",l="success"===t.type?"text-green-400":"error"===t.type?"text-red-400":"text-blue-400";return(0,s.jsxs)("div",{className:"".concat(a," border rounded-lg shadow-lg p-4 mb-3 flex items-center gap-3 min-w-[300px] max-w-md animate-slide-in"),children:["success"===t.type&&(0,s.jsx)("svg",{className:"w-5 h-5 ".concat(l," flex-shrink-0"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"error"===t.type&&(0,s.jsx)("svg",{className:"w-5 h-5 ".concat(l," flex-shrink-0"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"info"===t.type&&(0,s.jsx)("svg",{className:"w-5 h-5 ".concat(l," flex-shrink-0"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,s.jsx)("p",{className:"flex-1 text-sm font-medium",children:t.message}),(0,s.jsx)("button",{onClick:()=>r(t.id),className:"text-gray-400 hover:text-gray-600",children:(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}let o=(0,i.createContext)(void 0);function c(e){let{children:t}=e,[r,a]=(0,i.useState)([]),c=(0,i.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,s=Math.random().toString(36).substring(7);a(a=>[...a,{id:s,message:e,type:t,duration:r}])},[]),d=(0,i.useCallback)(e=>{a(t=>t.filter(t=>t.id!==e))},[]);return(0,s.jsxs)(o.Provider,{value:{showToast:c},children:[t,(0,s.jsx)("div",{className:"jsx-b8ef3436bcf78b76 fixed top-4 right-4 z-50 flex flex-col items-end",children:r.map(e=>(0,s.jsx)(n,{toast:e,onClose:d},e.id))}),(0,s.jsx)(l(),{id:"b8ef3436bcf78b76",children:"@keyframes slide-in{from{transform:translatex(100%);opacity:0}to{transform:translatex(0);opacity:1}}.animate-slide-in{animation:slide-in.3s ease-out}"})]})}function d(){let e=(0,i.useContext)(o);if(!e)throw Error("useToast must be used within ToastProvider");return e}}},e=>{e.O(0,[1500,5417,6394,4139,7248,8747,8441,1255,7358],()=>e(e.s=19562)),_N_E=e.O()}]);