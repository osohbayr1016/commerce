(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[279],{63:(e,r,t)=>{"use strict";var a=t(7260);t.o(a,"usePathname")&&t.d(r,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(r,{useSearchParams:function(){return a.useSearchParams}})},4269:(e,r,t)=>{"use strict";function a(e){return new Intl.NumberFormat("mn-MN").format(e)}t.d(r,{$:()=>a})},6709:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>p});var a=t(5155),s=t(2115),l=t(63),n=t(6424),d=t(5042),i=t(5380),o=t(7740);function u(e){let{items:r,defaultValues:t,onSuccess:l}=e,[n,d]=(0,s.useState)(t),[i,o]=(0,s.useState)(!1),[u,c]=(0,s.useState)("");(0,s.useEffect)(()=>{d(e=>({...e,...t}))},[t]);let m=e=>{let{name:r,value:t}=e.target;d(e=>({...e,[r]:t}))},x=async e=>{if(e.preventDefault(),0!==r.length){o(!0),c("");try{if(!(await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:r,customer:n})})).ok)throw Error("Захиалга үүсгэхэд алдаа гарлаа");l()}catch(e){c("Захиалга үүсгэхэд алдаа гарлаа")}finally{o(!1)}}};return(0,a.jsxs)("form",{onSubmit:x,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,a.jsx)("input",{name:"fullName",value:n.fullName,onChange:m,placeholder:"Нэр",className:"rounded-lg border border-gray-300 px-4 py-2 text-gray-900",required:!0}),(0,a.jsx)("input",{name:"phone",value:n.phone,onChange:m,placeholder:"Утас",className:"rounded-lg border border-gray-300 px-4 py-2 text-gray-900",required:!0})]}),(0,a.jsx)("input",{name:"email",value:n.email,onChange:m,placeholder:"Имэйл",type:"email",className:"w-full rounded-lg border border-gray-300 px-4 py-2 text-gray-900",required:!0}),(0,a.jsx)("input",{name:"address",value:n.address,onChange:m,placeholder:"Хаяг",className:"w-full rounded-lg border border-gray-300 px-4 py-2 text-gray-900",required:!0}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,a.jsx)("input",{name:"city",value:n.city,onChange:m,placeholder:"Хот",className:"rounded-lg border border-gray-300 px-4 py-2 text-gray-900"}),(0,a.jsx)("input",{name:"district",value:n.district,onChange:m,placeholder:"Дүүрэг",className:"rounded-lg border border-gray-300 px-4 py-2 text-gray-900"}),(0,a.jsx)("input",{name:"zip",value:n.zip,onChange:m,placeholder:"Zip",className:"rounded-lg border border-gray-300 px-4 py-2 text-gray-900"})]}),(0,a.jsx)("textarea",{name:"note",value:n.note,onChange:m,placeholder:"Тэмдэглэл",className:"w-full rounded-lg border border-gray-300 px-4 py-2 text-gray-900",rows:4}),u&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:u}),(0,a.jsx)("button",{type:"submit",disabled:i,className:"rounded-full bg-gray-900 px-6 py-3 text-white text-base font-medium hover:bg-gray-800 disabled:opacity-60",children:i?"Илгээж байна...":"Захиалга хийх"})]})}var c=t(4269);function m(e){let{items:r,subtotal:t}=e;return(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 h-fit",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Товчоон"}),(0,a.jsx)("div",{className:"space-y-2 text-sm text-gray-700",children:r.map(e=>(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("span",{children:[e.name," x ",e.quantity]}),(0,a.jsxs)("span",{children:[(0,c.$)(e.price*e.quantity)," ₮"]})]},e.id))}),(0,a.jsxs)("div",{className:"border-t border-gray-200 mt-4 pt-4 flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Нийт"}),(0,a.jsxs)("span",{className:"text-lg font-semibold text-gray-900",children:[(0,c.$)(t)," ₮"]})]})]})}let x={fullName:"",phone:"",email:"",address:"",city:"",district:"",zip:"",note:""};function p(){let{user:e,profile:r,loading:t}=(0,i.A)(),{items:c,subtotal:p,clearCart:h}=(0,o._)(),g=(0,l.useRouter)(),y=(0,s.useMemo)(()=>({...x,fullName:(null==r?void 0:r.full_name)||"",phone:(null==r?void 0:r.phone_number)||"",email:(null==e?void 0:e.email)||""}),[r,e]);return((0,s.useEffect)(()=>{t||e||g.push("/auth/login?redirect=/checkout")},[t,e,g]),t)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-white",children:(0,a.jsx)("p",{className:"text-gray-600",children:"Уншиж байна..."})}):(0,a.jsxs)("div",{className:"min-h-screen flex flex-col bg-white",children:[(0,a.jsx)(n.A,{}),(0,a.jsx)("main",{className:"flex-1 py-8 md:py-12",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("h1",{className:"text-3xl md:text-4xl font-semibold text-gray-900",children:"Захиалга баталгаажуулах"})}),0===c.length?(0,a.jsx)("div",{className:"border border-gray-200 rounded-lg p-8 text-center",children:(0,a.jsx)("p",{className:"text-gray-600",children:"Сагс хоосон байна"})}):(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,a.jsx)("div",{className:"lg:col-span-2",children:(0,a.jsx)(u,{items:c,defaultValues:y,onSuccess:()=>{h(),g.push("/profile?tab=orders")}})}),(0,a.jsx)(m,{items:c,subtotal:p})]})]})}),(0,a.jsx)(d.A,{})]})}},7740:(e,r,t)=>{"use strict";t.d(r,{CartProvider:()=>d,_:()=>i});var a=t(5155),s=t(2115),l=t(5380);let n=(0,s.createContext)(void 0);function d(e){let{children:r}=e,{user:t}=(0,l.A)(),[d,i]=(0,s.useState)([]),o=t?"cart:".concat(t.id):null;(0,s.useEffect)(()=>{if(!o)return void i([]);let e=localStorage.getItem(o);i(e?JSON.parse(e):[])},[o]),(0,s.useEffect)(()=>{o&&localStorage.setItem(o,JSON.stringify(d))},[d,o]);let u=(0,s.useMemo)(()=>d.reduce((e,r)=>e+r.price*r.quantity,0),[d]),c=(0,s.useMemo)(()=>d.reduce((e,r)=>e+r.quantity,0),[d]);return(0,a.jsx)(n.Provider,{value:{items:d,subtotal:u,totalItems:c,addItem:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t?(i(t=>t.find(r=>r.id===e.id)?t.map(t=>t.id===e.id?{...t,quantity:t.quantity+r}:t):[...t,{...e,quantity:r}]),{ok:!0}):{ok:!1}},updateQuantity:(e,r)=>{i(t=>t.map(t=>t.id===e?{...t,quantity:Math.max(1,r)}:t))},removeItem:e=>{i(r=>r.filter(r=>r.id!==e))},clearCart:()=>{i([])}},children:r})}function i(){let e=(0,s.useContext)(n);if(!e)throw Error("useCart must be used within a CartProvider");return e}},9562:(e,r,t)=>{Promise.resolve().then(t.bind(t,6709))}},e=>{e.O(0,[417,516,441,493,358],()=>e(e.s=9562)),_N_E=e.O()}]);