(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[93,548,959,974],{63:(e,r,t)=>{"use strict";var o=t(7260);t.o(o,"usePathname")&&t.d(r,{usePathname:function(){return o.usePathname}}),t.o(o,"useRouter")&&t.d(r,{useRouter:function(){return o.useRouter}}),t.o(o,"useSearchParams")&&t.d(r,{useSearchParams:function(){return o.useSearchParams}})},2436:(e,r,t)=>{"use strict";t.d(r,{default:()=>l});var o=t(5155),n=t(63),a=t(5380),i=t(7740);function l(e){let{product:r,slug:t}=e,{user:l}=(0,a.A)(),{addItem:s}=(0,i._)(),u=(0,n.useRouter)(),c=(0,n.usePathname)();return(0,o.jsx)("button",{onClick:()=>{if(!l)return void u.push("/auth/login?redirect=".concat(encodeURIComponent(c)));r.id&&s({id:String(r.id||""),name:r.nameEn,price:r.price,originalPrice:r.originalPrice,quantity:1,slug:t,brand:r.brand,imageColor:r.imageColor,brandColor:r.brandColor})},className:"w-full rounded-full border border-gray-200 px-3 py-2 text-xs text-gray-700 hover:border-gray-300 hover:text-gray-900",children:"Сагслах"})}},4001:(e,r,t)=>{"use strict";t.d(r,{default:()=>u});var o=t(5155),n=t(2115),a=t(2619),i=t.n(a),l=t(63),s=t(5380);function u(){var e,r,t,a;let[u,c]=(0,n.useState)(!1),d=(0,n.useRef)(null),{user:h,profile:m,signOut:p,isAdmin:f}=(0,s.A)(),g=(0,l.useRouter)();(0,n.useEffect)(()=>{function e(e){d.current&&!d.current.contains(e.target)&&c(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let x=async()=>{try{await p(),c(!1),g.push("/")}catch(e){console.error("Error signing out:",e)}};return h?(0,o.jsxs)("div",{className:"relative",ref:d,children:[(0,o.jsxs)("button",{onClick:()=>c(!u),className:"flex items-center space-x-2 text-gray-700 hover:text-gray-900",children:[(0,o.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-900 flex items-center justify-center text-white font-medium text-sm",children:(null==m||null==(r=m.full_name)||null==(e=r[0])?void 0:e.toUpperCase())||"U"}),(0,o.jsx)("svg",{className:"w-4 h-4 transition-transform ".concat(u?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),u&&(0,o.jsxs)("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50",children:[(0,o.jsxs)("div",{className:"px-4 py-3 border-b border-gray-200",children:[(0,o.jsx)("p",{className:"text-sm font-medium text-gray-900",children:(null==m?void 0:m.full_name)||"Хэрэглэгч"}),(0,o.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:(null==(t=h.user_metadata)?void 0:t.phone_number)||h.phone||(null==(a=h.email)?void 0:a.replace("@phone.app",""))}),f&&(0,o.jsx)("span",{className:"inline-block mt-2 px-2 py-1 text-xs font-medium bg-gray-900 text-white rounded",children:"Админ"})]}),(0,o.jsxs)("div",{className:"py-2",children:[(0,o.jsx)(i(),{href:"/profile",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>c(!1),children:"\uD83D\uDC64 Миний профайл"}),(0,o.jsx)(i(),{href:"/profile?tab=orders",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>c(!1),children:"\uD83D\uDCE6 Миний захиалга"}),(0,o.jsx)(i(),{href:"/profile?tab=wishlist",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>c(!1),children:"❤️ Хадгалсан"}),f&&(0,o.jsx)(i(),{href:"/admin",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>c(!1),children:"Админ самбар"})]}),(0,o.jsx)("div",{className:"border-t border-gray-200 pt-2",children:(0,o.jsx)("button",{onClick:x,className:"block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50",children:"Гарах"})})]})]}):(0,o.jsx)(i(),{href:"/auth/login",className:"text-gray-700 hover:text-gray-900 text-sm md:text-base whitespace-nowrap font-medium",children:"нэвтрэх/бүртгүүлэх"})}},5380:(e,r,t)=>{"use strict";t.d(r,{A:()=>s,AuthProvider:()=>l});var o=t(5155),n=t(2115),a=t(6648);let i=(0,n.createContext)(void 0);function l(e){let{children:r}=e,[t,l]=(0,n.useState)(null),[s,u]=(0,n.useState)(null),[c,d]=(0,n.useState)(!0),h=(0,a.U)();(0,n.useEffect)(()=>{h.auth.getSession().then(e=>{var r;let{data:{session:t}}=e;l(null!=(r=null==t?void 0:t.user)?r:null),(null==t?void 0:t.user)?m(t.user.id):d(!1)});let{data:{subscription:e}}=h.auth.onAuthStateChange((e,r)=>{var t;l(null!=(t=null==r?void 0:r.user)?t:null),(null==r?void 0:r.user)?m(r.user.id):(u(null),d(!1))});return()=>e.unsubscribe()},[]);let m=async e=>{try{let{data:r,error:t}=await h.from("profiles").select("*").eq("id",e).single();if(t)throw t;u(r)}catch(e){console.error("Error fetching profile:",e)}finally{d(!1)}},p=async(e,r,t,o)=>{let n=r.replace(/[^0-9]/g,""),{data:a,error:i}=await h.auth.signUp({email:e,password:t,options:{data:{full_name:o||"",phone_number:n},emailRedirectTo:void 0}});if(i)throw i;a.user&&(l(a.user),await m(a.user.id))},f=async(e,r)=>{let t;if(e.includes("@"))console.log("Login with email:",t=e.trim());else{let r=e.replace(/[^0-9]/g,"");if(console.log("Login with phone:",r),!r||r.length<8)throw Error("Утасны дугаар буруу байна");let{data:o,error:n}=await h.from("profiles").select("email").eq("phone_number",r).single();if(console.log("Profile lookup result:",{profile:o,profileError:n}),n)throw console.error("Profile lookup error:",n),Error("Утасны дугаараар бүртгэл олдсонгүй. И-мэйл ашиглана уу.");if(!(null==o?void 0:o.email))throw Error("Бүртгэлийн мэдээлэл дутуу байна. Та дахин бүртгүүлнэ үү.");console.log("Using email from profile:",t=o.email)}let{data:o,error:n}=await h.auth.signInWithPassword({email:t,password:r});if(n)throw console.error("Supabase auth error:",n),n;console.log("Login successful!")},g=async()=>{let{data:e,error:r}=await h.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});if(r)throw r},x=async()=>{let{error:e}=await h.auth.signOut();if(e)throw e},v=(null==s?void 0:s.role)==="admin";return(0,o.jsx)(i.Provider,{value:{user:t,profile:s,loading:c,signUp:p,signIn:f,signInWithGoogle:g,signOut:x,isAdmin:v},children:r})}function s(){let e=(0,n.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},6648:(e,r,t)=>{"use strict";t.d(r,{U:()=>n});var o=t(5417);function n(){let e="https://ejdwrepyuznanwujidai.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVqZHdyZXB5dXpuYW53dWppZGFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzNjk3NTYsImV4cCI6MjA4Mzk0NTc1Nn0.MRJe6csColzMRDpAWa-Ma99noAk6n8SbnXXHP2rNAJ4";return e&&r?(0,o.createBrowserClient)(e,r):(console.error("Missing Supabase environment variables"),(0,o.createBrowserClient)("https://placeholder.supabase.co","placeholder-key"))}},7740:(e,r,t)=>{"use strict";t.d(r,{CartProvider:()=>l,_:()=>s});var o=t(5155),n=t(2115),a=t(5380);let i=(0,n.createContext)(void 0);function l(e){let{children:r}=e,{user:t}=(0,a.A)(),[l,s]=(0,n.useState)([]),u=t?"cart:".concat(t.id):null;(0,n.useEffect)(()=>{if(!u)return void s([]);let e=localStorage.getItem(u);s(e?JSON.parse(e):[])},[u]),(0,n.useEffect)(()=>{u&&localStorage.setItem(u,JSON.stringify(l))},[l,u]);let c=(0,n.useMemo)(()=>l.reduce((e,r)=>e+r.price*r.quantity,0),[l]),d=(0,n.useMemo)(()=>l.reduce((e,r)=>e+r.quantity,0),[l]);return(0,o.jsx)(i.Provider,{value:{items:l,subtotal:c,totalItems:d,addItem:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t?(s(t=>t.find(r=>r.id===e.id)?t.map(t=>t.id===e.id?{...t,quantity:t.quantity+r}:t):[...t,{...e,quantity:r}]),{ok:!0}):{ok:!1}},updateQuantity:(e,r)=>{s(t=>t.map(t=>t.id===e?{...t,quantity:Math.max(1,r)}:t))},removeItem:e=>{s(r=>r.filter(r=>r.id!==e))},clearCart:()=>{s([])}},children:r})}function s(){let e=(0,n.useContext)(i);if(!e)throw Error("useCart must be used within a CartProvider");return e}},7974:(e,r,t)=>{Promise.resolve().then(t.bind(t,4001)),Promise.resolve().then(t.bind(t,2436))}},e=>{e.O(0,[417,619,441,493,358],()=>e(e.s=7974)),_N_E=e.O()}]);