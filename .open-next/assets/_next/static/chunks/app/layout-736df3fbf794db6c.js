(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7177],{10832:(e,t,r)=>{"use strict";r.d(t,{ModalProvider:()=>d,h:()=>c});var n=r(95155),o=r(25959),i=r(12115),s=r(47650);function a(e){let{isOpen:t,type:r,title:o,message:a,confirmText:l="OK",cancelText:c="Cancel",onConfirm:d,onCancel:u,onClose:m}=e;if((0,i.useEffect)(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t]),(0,i.useEffect)(()=>{let e=e=>{"Escape"===e.key&&t&&m()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t,m]),!t)return null;let f=()=>{d?d():m()},h=(0,n.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,n.jsxs)("div",{className:"flex min-h-screen items-end justify-center px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[(0,n.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:m}),(0,n.jsx)("span",{className:"hidden sm:inline-block sm:h-screen sm:align-middle",children:"​"}),(0,n.jsxs)("div",{className:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6",children:[(0,n.jsxs)("div",{children:[(()=>{switch(r){case"success":return(0,n.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100",children:(0,n.jsx)("svg",{className:"h-6 w-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})});case"error":return(0,n.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100",children:(0,n.jsx)("svg",{className:"h-6 w-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})});case"warning":return(0,n.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-yellow-100",children:(0,n.jsx)("svg",{className:"h-6 w-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})});case"confirm":return(0,n.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100",children:(0,n.jsx)("svg",{className:"h-6 w-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})}})(),(0,n.jsxs)("div",{className:"mt-3 text-center sm:mt-5",children:[(0,n.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:o}),(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsx)("p",{className:"text-sm text-gray-500",children:a})})]})]}),(0,n.jsx)("div",{className:"mt-5 sm:mt-6 sm:grid sm:grid-cols-2 sm:gap-3 sm:grid-flow-row-dense",children:"confirm"===r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{type:"button",onClick:f,className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:col-start-2 sm:text-sm",children:l}),(0,n.jsx)("button",{type:"button",onClick:()=>{u?u():m()},className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:col-start-1 sm:text-sm",children:c})]}):(0,n.jsx)("button",{type:"button",onClick:f,className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:col-span-2 sm:text-sm",children:l})})]})]})});return"undefined"!=typeof document?(0,s.createPortal)(h,document.body):null}let l=(0,o.v)(e=>({isOpen:!1,type:"success",title:"",message:"",confirmText:"OK",cancelText:"Cancel",showModal:t=>e({...t,isOpen:!0}),closeModal:()=>e({isOpen:!1})}));function c(){let e=l();return{showSuccess:function(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"OK";e.showModal({type:"success",title:t,message:r,confirmText:n})},showError:function(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"OK";e.showModal({type:"error",title:t,message:r,confirmText:n})},showWarning:function(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"OK";e.showModal({type:"warning",title:t,message:r,confirmText:n})},showConfirm:function(t,r,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Confirm",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Cancel";e.showModal({type:"confirm",title:t,message:r,confirmText:o,cancelText:i,onConfirm:n})},close:e.closeModal}}function d(){let e=l();return(0,n.jsx)(a,{isOpen:e.isOpen,type:e.type,title:e.title,message:e.message,confirmText:e.confirmText,cancelText:e.cancelText,onConfirm:e.onConfirm,onCancel:e.onCancel,onClose:e.closeModal})}},13673:()=>{},52503:(e,t,r)=>{"use strict";r.d(t,{CartProvider:()=>m,_:()=>f});var n=r(95155),o=r(12115),i=r(65380);async function s(e){try{for(let t of e)await l(t.id,t.quantity,t.size)}catch(e){}}async function a(){try{let e=await fetch("/api/cart");if(!e.ok)return[];return(await e.json()).items||[]}catch(e){return[]}}async function l(e,t,r){try{return(await fetch("/api/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:e,quantity:t,size:r||null})})).ok}catch(e){return!1}}async function c(e,t,r){try{return(await fetch("/api/cart",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:e,quantity:t,size:r||null})})).ok}catch(e){return!1}}async function d(e,t){try{let r=new URL("/api/cart",window.location.origin);return r.searchParams.set("product_id",e),t&&r.searchParams.set("size",t.toString()),(await fetch(r.toString(),{method:"DELETE"})).ok}catch(e){return!1}}let u=(0,o.createContext)(void 0);function m(e){let{children:t}=e,{user:r}=(0,i.A)(),[m,f]=(0,o.useState)([]),[h,p]=(0,o.useState)(!1),x=(0,o.useRef)(null),g=(0,o.useRef)(!0),w=r?"cart:".concat(r.id):null;(0,o.useEffect)(()=>{if(!r||!w)return void f([]);(async()=>{p(!0);try{let e=await a(),t=localStorage.getItem(w),r=t?JSON.parse(t):[],n=[...e];r.forEach(e=>{n.find(t=>t.id===e.id&&t.size===e.size)||n.push(e)}),f(n),localStorage.setItem(w,JSON.stringify(n)),r.length>0&&e.length!==n.length&&await s(n)}catch(t){let e=localStorage.getItem(w);f(e?JSON.parse(e):[])}finally{p(!1),g.current=!1}})()},[r,w]),(0,o.useEffect)(()=>{w&&!g.current&&localStorage.setItem(w,JSON.stringify(m))},[m,w]),(0,o.useEffect)(()=>{if(r&&w&&!g.current)return x.current&&clearTimeout(x.current),x.current=setTimeout(async()=>{p(!0);try{for(let e of m)await l(e.id,e.quantity,e.size)}catch(e){}finally{p(!1)}},1e3),()=>{x.current&&clearTimeout(x.current)}},[m,r,w]);let v=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!r)return{ok:!1};try{let r=await fetch("/api/products/".concat(e.id,"/stock"));if(r.ok){var n;let o=await r.json(),i=((null==(n=m.find(t=>t.id===e.id&&t.size===e.size))?void 0:n.quantity)||0)+t;if(o.stock<i)return{ok:!1,error:0===o.stock?"Бэлэн бараа байхгүй":"Зөвхөн ".concat(o.stock," ширхэг үлдсэн")}}}catch(e){}f(r=>r.find(t=>t.id===e.id&&t.size===e.size)?r.map(r=>r.id===e.id&&r.size===e.size?{...r,quantity:r.quantity+t}:r):[...r,{...e,quantity:t}]);try{await l(e.id,t,e.size)}catch(e){}return{ok:!0}},y=async(e,t)=>{let r=Math.max(1,t),n=m.find(t=>t.id===e);try{let t=await fetch("/api/products/".concat(e,"/stock"));if(t.ok){let o=await t.json();if(o.stock<r){let t=Math.min(o.stock,r);f(r=>r.map(r=>r.id===e?{...r,quantity:t}:r)),n&&await c(e,t,n.size);return}}}catch(e){}if(f(t=>t.map(t=>t.id===e?{...t,quantity:r}:t)),n)try{await c(e,r,n.size)}catch(e){}},b=async e=>{let t=m.find(t=>t.id===e);if(f(t=>t.filter(t=>t.id!==e)),t)try{await d(e,t.size)}catch(e){}},j=async()=>{if(r)try{for(let e of m)await d(e.id,e.size)}catch(e){}f([])},k=(0,o.useMemo)(()=>m.reduce((e,t)=>e+t.price*t.quantity,0),[m]),C=(0,o.useMemo)(()=>m.reduce((e,t)=>e+t.quantity,0),[m]);return(0,n.jsx)(u.Provider,{value:{items:m,subtotal:k,totalItems:C,addItem:v,updateQuantity:y,removeItem:b,clearCart:j,syncing:h},children:t})}function f(){let e=(0,o.useContext)(u);if(!e)throw Error("useCart must be used within a CartProvider");return e}},65380:(e,t,r)=>{"use strict";r.d(t,{A:()=>l,AuthProvider:()=>a});var n=r(95155),o=r(12115),i=r(96648);let s=(0,o.createContext)(void 0);function a(e){let{children:t}=e,[r,a]=(0,o.useState)(null),[l,c]=(0,o.useState)(null),[d,u]=(0,o.useState)(!0),m=(0,i.U)();(0,o.useEffect)(()=>{m.auth.getSession().then(e=>{var t;let{data:{session:r}}=e;a(null!=(t=null==r?void 0:r.user)?t:null),(null==r?void 0:r.user)?f(r.user.id):u(!1)});let{data:{subscription:e}}=m.auth.onAuthStateChange((e,t)=>{var r;a(null!=(r=null==t?void 0:t.user)?r:null),(null==t?void 0:t.user)?f(t.user.id):(c(null),u(!1))});return()=>e.unsubscribe()},[]);let f=async e=>{try{let{data:t,error:r}=await m.from("profiles").select("*").eq("id",e).single();if(r)throw r;c(t)}catch(e){}finally{u(!1)}},h=async(e,t,r,n)=>{let o=t.replace(/[^0-9]/g,""),{data:i,error:s}=await m.auth.signUp({email:e,password:r,options:{data:{full_name:n||"",phone_number:o},emailRedirectTo:void 0}});if(s){if(s.message.includes("Signups not allowed"))throw Error('Бүртгэл идэвхгүй байна. Суpabase dashboard-аас "Enable email signups" асаах шаардлагатай. Authentication → Providers → Email → Enable email signups');throw s}i.user&&(a(i.user),await f(i.user.id))},p=async(e,t)=>{let r;if(e.includes("@"))r=e.trim();else{let t=e.replace(/[^0-9]/g,"");if(!t||t.length<8)throw Error("Утасны дугаар буруу байна");let{data:n,error:o}=await m.from("profiles").select("email").eq("phone_number",t).single();if(o)throw Error("Утасны дугаараар бүртгэл олдсонгүй. И-мэйл ашиглана уу.");if(!(null==n?void 0:n.email))throw Error("Бүртгэлийн мэдээлэл дутуу байна. Та дахин бүртгүүлнэ үү.");r=n.email}let{data:n,error:o}=await m.auth.signInWithPassword({email:r,password:t});if(o)throw o},x=async()=>{let{data:e,error:t}=await m.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});if(t)throw t},g=async()=>{let{error:e}=await m.auth.signOut();if(e)throw e},w=(null==l?void 0:l.role)==="admin";return(0,n.jsx)(s.Provider,{value:{user:r,profile:l,loading:d,signUp:h,signIn:p,signInWithGoogle:x,signOut:g,isAdmin:w},children:t})}function l(){let e=(0,o.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},66905:(e,t,r)=>{"use strict";r.d(t,{ToastProvider:()=>c,d:()=>d});var n=r(95155),o=r(88661),i=r.n(o),s=r(12115);function a(e){let{toast:t,onClose:r}=e;(0,s.useEffect)(()=>{let e=setTimeout(()=>{r(t.id)},t.duration||3e3);return()=>clearTimeout(e)},[t.id,t.duration,r]);let o="success"===t.type?"bg-green-50 border-green-200 text-green-800":"error"===t.type?"bg-red-50 border-red-200 text-red-800":"bg-blue-50 border-blue-200 text-blue-800",i="success"===t.type?"text-green-400":"error"===t.type?"text-red-400":"text-blue-400";return(0,n.jsxs)("div",{className:"".concat(o," border rounded-lg shadow-lg p-4 mb-3 flex items-center gap-3 min-w-[300px] max-w-md animate-slide-in"),children:["success"===t.type&&(0,n.jsx)("svg",{className:"w-5 h-5 ".concat(i," flex-shrink-0"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"error"===t.type&&(0,n.jsx)("svg",{className:"w-5 h-5 ".concat(i," flex-shrink-0"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"info"===t.type&&(0,n.jsx)("svg",{className:"w-5 h-5 ".concat(i," flex-shrink-0"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,n.jsx)("p",{className:"flex-1 text-sm font-medium",children:t.message}),(0,n.jsx)("button",{onClick:()=>r(t.id),className:"text-gray-400 hover:text-gray-600",children:(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}let l=(0,s.createContext)(void 0);function c(e){let{children:t}=e,[r,o]=(0,s.useState)([]),c=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,n=Math.random().toString(36).substring(7);o(o=>[...o,{id:n,message:e,type:t,duration:r}])},[]),d=(0,s.useCallback)(e=>{o(t=>t.filter(t=>t.id!==e))},[]);return(0,n.jsxs)(l.Provider,{value:{showToast:c},children:[t,(0,n.jsx)("div",{className:"jsx-b8ef3436bcf78b76 fixed top-4 right-4 z-50 flex flex-col items-end",children:r.map(e=>(0,n.jsx)(a,{toast:e,onClose:d},e.id))}),(0,n.jsx)(i(),{id:"b8ef3436bcf78b76",children:"@keyframes slide-in{from{transform:translatex(100%);opacity:0}to{transform:translatex(0);opacity:1}}.animate-slide-in{animation:slide-in.3s ease-out}"})]})}function d(){let e=(0,s.useContext)(l);if(!e)throw Error("useToast must be used within ToastProvider");return e}},79366:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,52619,23)),Promise.resolve().then(r.t.bind(r,4635,23)),Promise.resolve().then(r.t.bind(r,58615,23)),Promise.resolve().then(r.t.bind(r,13673,23)),Promise.resolve().then(r.bind(r,66905)),Promise.resolve().then(r.bind(r,65380)),Promise.resolve().then(r.bind(r,52503)),Promise.resolve().then(r.bind(r,82435)),Promise.resolve().then(r.bind(r,18747)),Promise.resolve().then(r.bind(r,10832))},82435:(e,t,r)=>{"use strict";r.d(t,{ComparisonProvider:()=>a,l:()=>l});var n=r(95155),o=r(12115),i=r(66905);let s=(0,o.createContext)(void 0);function a(e){let{children:t}=e,[r,a]=(0,o.useState)([]),{showToast:l}=(0,i.d)();return(0,o.useEffect)(()=>{let e=localStorage.getItem("comparison");if(e)try{a(JSON.parse(e))}catch(e){localStorage.removeItem("comparison")}},[]),(0,o.useEffect)(()=>{r.length>0?localStorage.setItem("comparison",JSON.stringify(r)):localStorage.removeItem("comparison")},[r]),(0,n.jsx)(s.Provider,{value:{comparisonProducts:r,addToComparison:e=>r.length>=4?void l("Maximum ".concat(4," products can be compared"),"error"):r.find(t=>t.id===e.id)?void l("Product already in comparison","info"):void(a(t=>[...t,e]),l("Added to comparison","success")),removeFromComparison:e=>{a(t=>t.filter(t=>t.id!==e)),l("Removed from comparison","info")},clearComparison:()=>{a([]),localStorage.removeItem("comparison"),l("Comparison cleared","info")},isInComparison:e=>r.some(t=>t.id===e)},children:t})}function l(){let e=(0,o.useContext)(s);if(!e)throw Error("useComparison must be used within ComparisonProvider");return e}},96648:(e,t,r)=>{"use strict";r.d(t,{U:()=>i});var n=r(55417);let o=null;function i(){return o||(o=(0,n.createBrowserClient)("https://ejdwrepyuznanwujidai.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVqZHdyZXB5dXpuYW53dWppZGFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzNjk3NTYsImV4cCI6MjA4Mzk0NTc1Nn0.MRJe6csColzMRDpAWa-Ma99noAk6n8SbnXXHP2rNAJ4")),o}}},e=>{e.O(0,[4614,1500,5417,2619,8179,8747,8441,1255,7358],()=>e(e.s=79366)),_N_E=e.O()}]);