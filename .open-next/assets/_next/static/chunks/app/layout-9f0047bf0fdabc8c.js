(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{3673:()=>{},4635:e=>{e.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_188709",variable:"__variable_188709"}},5380:(e,r,l)=>{"use strict";l.d(r,{A:()=>s,AuthProvider:()=>n});var o=l(5155),t=l(2115),i=l(6648);let a=(0,t.createContext)(void 0);function n(e){let{children:r}=e,[l,n]=(0,t.useState)(null),[s,u]=(0,t.useState)(null),[c,h]=(0,t.useState)(!0),d=(0,i.U)();(0,t.useEffect)(()=>{d.auth.getSession().then(e=>{var r;let{data:{session:l}}=e;n(null!=(r=null==l?void 0:l.user)?r:null),(null==l?void 0:l.user)?p(l.user.id):h(!1)});let{data:{subscription:e}}=d.auth.onAuthStateChange((e,r)=>{var l;n(null!=(l=null==r?void 0:r.user)?l:null),(null==r?void 0:r.user)?p(r.user.id):(u(null),h(!1))});return()=>e.unsubscribe()},[]);let p=async e=>{try{let{data:r,error:l}=await d.from("profiles").select("*").eq("id",e).single();if(l)throw l;u(r)}catch(e){console.error("Error fetching profile:",e)}finally{h(!1)}},m=async(e,r,l,o)=>{let t=r.replace(/[^0-9]/g,""),{data:i,error:a}=await d.auth.signUp({email:e,password:l,options:{data:{full_name:o||"",phone_number:t},emailRedirectTo:void 0}});if(a)throw a;i.user&&(n(i.user),await p(i.user.id))},f=async(e,r)=>{let l;if(e.includes("@"))console.log("Login with email:",l=e.trim());else{let r=e.replace(/[^0-9]/g,"");if(console.log("Login with phone:",r),!r||r.length<8)throw Error("Утасны дугаар буруу байна");let{data:o,error:t}=await d.from("profiles").select("email").eq("phone_number",r).single();if(console.log("Profile lookup result:",{profile:o,profileError:t}),t)throw console.error("Profile lookup error:",t),Error("Утасны дугаараар бүртгэл олдсонгүй. И-мэйл ашиглана уу.");if(!(null==o?void 0:o.email))throw Error("Бүртгэлийн мэдээлэл дутуу байна. Та дахин бүртгүүлнэ үү.");console.log("Using email from profile:",l=o.email)}let{data:o,error:t}=await d.auth.signInWithPassword({email:l,password:r});if(t)throw console.error("Supabase auth error:",t),t;console.log("Login successful!")},w=async()=>{let{data:e,error:r}=await d.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});if(r)throw r},v=async()=>{let{error:e}=await d.auth.signOut();if(e)throw e},b=(null==s?void 0:s.role)==="admin";return(0,o.jsx)(a.Provider,{value:{user:l,profile:s,loading:c,signUp:m,signIn:f,signInWithGoogle:w,signOut:v,isAdmin:b},children:r})}function s(){let e=(0,t.useContext)(a);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},6258:(e,r,l)=>{Promise.resolve().then(l.t.bind(l,4635,23)),Promise.resolve().then(l.t.bind(l,8615,23)),Promise.resolve().then(l.t.bind(l,3673,23)),Promise.resolve().then(l.bind(l,5380))},6648:(e,r,l)=>{"use strict";l.d(r,{U:()=>t});var o=l(5417);function t(){let e="https://ejdwrepyuznanwujidai.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVqZHdyZXB5dXpuYW53dWppZGFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzNjk3NTYsImV4cCI6MjA4Mzk0NTc1Nn0.MRJe6csColzMRDpAWa-Ma99noAk6n8SbnXXHP2rNAJ4";return e&&r?(0,o.createBrowserClient)(e,r):(console.error("Missing Supabase environment variables"),(0,o.createBrowserClient)("https://placeholder.supabase.co","placeholder-key"))}},8615:e=>{e.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_9a8899",variable:"__variable_9a8899"}}},e=>{e.O(0,[614,417,441,493,358],()=>e(e.s=6258)),_N_E=e.O()}]);