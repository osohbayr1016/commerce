(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2379],{63:(e,t,r)=>{"use strict";var a=r(7260);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},2688:(e,t,r)=>{Promise.resolve().then(r.bind(r,4001))},4001:(e,t,r)=>{"use strict";r.d(t,{default:()=>u});var a=r(5155),s=r(2115),n=r(2619),i=r.n(n),l=r(63),o=r(5380);function u(){var e,t,r,n;let[u,c]=(0,s.useState)(!1),d=(0,s.useRef)(null),{user:h,profile:m,signOut:p,isAdmin:x}=(0,o.A)(),f=(0,l.useRouter)();(0,s.useEffect)(()=>{function e(e){d.current&&!d.current.contains(e.target)&&c(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let g=async()=>{try{await p(),c(!1),f.push("/")}catch(e){}};return h?(0,a.jsxs)("div",{className:"relative",ref:d,children:[(0,a.jsxs)("button",{onClick:()=>c(!u),className:"flex items-center space-x-2 text-gray-700 hover:text-gray-900",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-900 flex items-center justify-center text-white font-medium text-sm",children:(null==m||null==(t=m.full_name)||null==(e=t[0])?void 0:e.toUpperCase())||"U"}),(0,a.jsx)("svg",{className:"w-4 h-4 transition-transform ".concat(u?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),u&&(0,a.jsxs)("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b border-gray-200",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:(null==m?void 0:m.full_name)||"Хэрэглэгч"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:(null==(r=h.user_metadata)?void 0:r.phone_number)||h.phone||(null==(n=h.email)?void 0:n.replace("@phone.app",""))}),x&&(0,a.jsx)("span",{className:"inline-block mt-2 px-2 py-1 text-xs font-medium bg-gray-900 text-white rounded",children:"Админ"})]}),(0,a.jsxs)("div",{className:"py-2",children:[(0,a.jsx)(i(),{href:"/profile",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>c(!1),children:"\uD83D\uDC64 Миний профайл"}),(0,a.jsx)(i(),{href:"/profile?tab=orders",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>c(!1),children:"\uD83D\uDCE6 Миний захиалга"}),(0,a.jsx)(i(),{href:"/profile?tab=wishlist",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>c(!1),children:"❤️ Хадгалсан"}),x&&(0,a.jsx)(i(),{href:"/admin",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>c(!1),children:"Админ самбар"})]}),(0,a.jsx)("div",{className:"border-t border-gray-200 pt-2",children:(0,a.jsx)("button",{onClick:g,className:"block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50",children:"Гарах"})})]})]}):(0,a.jsx)(i(),{href:"/auth/login",className:"text-gray-700 hover:text-gray-900 text-sm md:text-base whitespace-nowrap font-medium",children:"нэвтрэх/бүртгүүлэх"})}},5380:(e,t,r)=>{"use strict";r.d(t,{A:()=>o,AuthProvider:()=>l});var a=r(5155),s=r(2115),n=r(6648);let i=(0,s.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,s.useState)(null),[o,u]=(0,s.useState)(null),[c,d]=(0,s.useState)(!0),h=(0,n.U)();(0,s.useEffect)(()=>{h.auth.getSession().then(e=>{var t;let{data:{session:r}}=e;l(null!=(t=null==r?void 0:r.user)?t:null),(null==r?void 0:r.user)?m(r.user.id):d(!1)});let{data:{subscription:e}}=h.auth.onAuthStateChange((e,t)=>{var r;l(null!=(r=null==t?void 0:t.user)?r:null),(null==t?void 0:t.user)?m(t.user.id):(u(null),d(!1))});return()=>e.unsubscribe()},[]);let m=async e=>{try{let{data:t,error:r}=await h.from("profiles").select("*").eq("id",e).single();if(r)throw r;u(t)}catch(e){}finally{d(!1)}},p=async(e,t,r,a)=>{let s=t.replace(/[^0-9]/g,""),{data:n,error:i}=await h.auth.signUp({email:e,password:r,options:{data:{full_name:a||"",phone_number:s},emailRedirectTo:void 0}});if(i){if(i.message.includes("Signups not allowed"))throw Error('Бүртгэл идэвхгүй байна. Суpabase dashboard-аас "Enable email signups" асаах шаардлагатай. Authentication → Providers → Email → Enable email signups');throw i}n.user&&(l(n.user),await m(n.user.id))},x=async(e,t)=>{let r;if(e.includes("@"))r=e.trim();else{let t=e.replace(/[^0-9]/g,"");if(!t||t.length<8)throw Error("Утасны дугаар буруу байна");let{data:a,error:s}=await h.from("profiles").select("email").eq("phone_number",t).single();if(s)throw Error("Утасны дугаараар бүртгэл олдсонгүй. И-мэйл ашиглана уу.");if(!(null==a?void 0:a.email))throw Error("Бүртгэлийн мэдээлэл дутуу байна. Та дахин бүртгүүлнэ үү.");r=a.email}let{data:a,error:s}=await h.auth.signInWithPassword({email:r,password:t});if(s)throw s},f=async()=>{let{data:e,error:t}=await h.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});if(t)throw t},g=async()=>{let{error:e}=await h.auth.signOut();if(e)throw e},v=(null==o?void 0:o.role)==="admin";return(0,a.jsx)(i.Provider,{value:{user:r,profile:o,loading:c,signUp:p,signIn:x,signInWithGoogle:f,signOut:g,isAdmin:v},children:t})}function o(){let e=(0,s.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},6648:(e,t,r)=>{"use strict";r.d(t,{U:()=>s});var a=r(5417);function s(){return(0,a.createBrowserClient)("https://ejdwrepyuznanwujidai.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVqZHdyZXB5dXpuYW53dWppZGFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzNjk3NTYsImV4cCI6MjA4Mzk0NTc1Nn0.MRJe6csColzMRDpAWa-Ma99noAk6n8SbnXXHP2rNAJ4")}}},e=>{e.O(0,[5417,2619,8441,1255,7358],()=>e(e.s=2688)),_N_E=e.O()}]);